<!-- Top Users Section - Plex Style -->
<div class="bg-base-200 text-neutral-content p-6 rounded-lg">
    <!-- Header -->
    <div class="flex justify-between items-center mb-6">
        <h2 class="text-lg font-bold uppercase tracking-wide text-white">TOP USERS</h2>
        <div class="dropdown dropdown-end">
            <div tabindex="0" role="button" class="btn btn-sm btn-ghost text-white">
                Last {{ selected_days if selected_days != -1 else 'All Time' }} Days
                <i class="fa-solid fa-chevron-down ml-1"></i>
            </div>
            <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                <li><a href="{{ url_for('dashboard.index', days=7) }}" class="{{ 'font-bold' if selected_days == 7 else '' }}">Last 7 Days</a></li>
                <li><a href="{{ url_for('dashboard.index', days=30) }}" class="{{ 'font-bold' if selected_days == 30 else '' }}">Last 30 Days</a></li>
                <li><a href="{{ url_for('dashboard.index', days=90) }}" class="{{ 'font-bold' if selected_days == 90 else '' }}">Last 90 Days</a></li>
                <li><a href="{{ url_for('dashboard.index', days='all') }}" class="{{ 'font-bold' if selected_days == -1 else '' }}">All Time</a></li>
            </ul>
        </div>
    </div>

    <!-- Users Grid -->
    {% if top_users_data and top_users_data|length > 0 %}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-3">
        {% for user in top_users_data %}
        <div class="bg-base-100 rounded-lg flex flex-col items-center text-white">
            <div class="flex mb-5 mt-5 gap-5">
                <!-- User Avatar -->
                {% set avatar_colors = ['bg-orange-400', 'bg-amber-500', 'bg-red-400', 'bg-pink-400', 'bg-purple-400', 'bg-blue-400', 'bg-green-400', 'bg-teal-400'] %}
                {% set color_index = loop.index0 % avatar_colors|length %}
                <div class="w-14 text-left h-14 rounded-full overflow-hidden {{ avatar_colors[color_index] }} flex items-center justify-center text-2xl font-bold">
                    {% if user.avatar_url %}
                    <img src="{{ user.avatar_url }}" alt="{{ user.display_name }}" class="w-full h-full object-cover">
                    {% else %}
                    {{ user.display_name[0]|upper if user.display_name else 'U' }}
                    {% endif %}
                </div>
                
                <!-- User Stats -->
                <div class="text-left self-center">
                    <div class="text-white font-medium">{{ user.stream_count }} plays</div>
                    <div class="text-white">{{ user.total_duration }}</div>
                </div>
            </div>
            
            <!-- Username -->
            {% if user.server_nickname and user.server_username %}
            <a href="{{ url_for('user.view_service_account', server_nickname=user.server_nickname, server_username=user.server_username) }}" 
               class="bg-base-300 font-bold text-white pl-5 pr-5 pt-2.5 pb-2.5 truncate w-full hover:text-primary transition-colors cursor-pointer">
                {{ user.display_name }}
            </a>
            {% else %}
            <div class="bg-base-300 font-bold text-white pl-5 pr-5 pt-2.5 pb-2.5 truncate w-full">{{ user.display_name }}</div>
            {% endif %}
            
            <!-- Categories Section -->
            <div class="w-full relative overflow-hidden">
                {% set category_data = user.get('categories', {}) %}
                {% set categories = [
                    ('TV', category_data.get('tv', '0 min')),
                    ('Movies', category_data.get('movies', '0 min')),
                    ('Music', category_data.get('music', '0 min')),
                    ('Photos', category_data.get('photos', '0 min'))
                ] %}
                
                <!-- Single gradient background for all categories -->
                <div class="absolute inset-0" style="background: linear-gradient(to bottom, var(--color-{{ user.primary_service_type }}-900), var(--color-{{ user.primary_service_type }}-950)"></div>
                
                {% for category_name, duration in categories %}
                <div class="relative flex justify-between items-center pl-5 pr-5 pt-2.5 pb-2.5 text-sm shadow-[0px_30px_77px_0px_oklch(0_0_0_/_0.48)]">
                    <span class="text-white">{{ category_name }}</span>
                    <span class="text-gray-300">{{ duration if duration != '0 min' else user.total_duration }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <!-- No Data State -->
    <div class="text-center py-12">
        <i class="fa-solid fa-users fa-4x text-gray-600 mb-4"></i>
        <p class="text-xl text-gray-300 mb-2">No user activity recorded</p>
        <p class="text-gray-400">User activity will appear here once streaming begins</p>
    </div>
    {% endif %}
</div>