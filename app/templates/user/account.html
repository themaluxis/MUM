<!-- File: app/templates/user/account.html -->
{% extends "base.html" %}

{% block title %}{{ super() }} - {{ title }}{% endblock %}

{% block content %}
<div class="min-h-screen bg-base-100">
    <!-- Back Navigation -->
    <div class="container mx-auto px-4 py-4">
        <a href="{{ url_for('user.index') }}" class="btn btn-ghost btn-sm">
            <i class="fa-solid fa-arrow-left"></i> Back to Dashboard
        </a>
    </div>

    <!-- Main Content Card -->
    <div class="container mx-auto px-4 pb-8 max-w-4xl">
        <div class="bg-base-100 border border-base-300 rounded-xl shadow-lg overflow-hidden">
            <!-- Hero Header Section -->
            <div class="bg-gradient-to-r from-primary/10 to-secondary/10 p-8 text-center border-b border-base-300">
                <div class="flex flex-col items-center space-y-4">
                    <!-- Avatar -->
                    <div class="avatar">
                        <div class="w-24 h-24 rounded-full ring-4 ring-primary/30 ring-offset-4 ring-offset-base-100">
                            {% if user.get_avatar and user.get_avatar() != '/static/img/default_avatar.png' %}
                                <img src="{{ user.get_avatar() }}" alt="{{ user.get_display_name() }} avatar" class="w-full h-full rounded-full object-cover" />
                            {% else %}
                                <div class="bg-primary text-primary-content w-24 h-24 rounded-full flex items-center justify-center text-3xl font-semibold">
                                    {{ user.get_display_name()[0]|upper }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- User Info -->
                    <div>
                        <h1 class="text-3xl font-bold text-base-content mb-2">{{ user.get_display_name() }}</h1>
                        <div class="flex items-center justify-center gap-2">
                            <span class="inline-flex items-center rounded-md bg-primary-50 dark:bg-primary-400/10 px-3 py-1 text-sm font-medium text-primary-700 dark:text-primary-400 ring-1 ring-inset ring-primary-600/20 dark:ring-primary-500/20 gap-2">
                                <i class="fa-solid fa-user w-4 h-4"></i>
                                User Account
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Navigation Tabs -->
            <div class="overflow-x-auto border-b border-base-300">
                <div role="tablist" class="tabs tabs-border whitespace-nowrap flex-nowrap">
                    <a role="tab" href="{{ url_for('user.account', tab='account') }}" class="tab {{ 'tab-active' if (request.args.get('tab', 'account') == 'account') else '' }}">
                        <i class="fa-solid fa-user mr-2"></i>Account
                    </a>
                    <a role="tab" href="{{ url_for('user.account', tab='security') }}" class="tab {{ 'tab-active' if (request.args.get('tab') == 'security') else '' }}">
                        <i class="fa-solid fa-shield-alt mr-2"></i>Security
                    </a>
                    <a role="tab" href="{{ url_for('user.account', tab='preferences') }}" class="tab {{ 'tab-active' if (request.args.get('tab') == 'preferences') else '' }}">
                        <i class="fa-solid fa-cog mr-2"></i>Preferences
                    </a>
                </div>
            </div>

            <!-- Tab Content -->
            <div class="p-6">
                {% set active_tab = request.args.get('tab', 'account') %}
                
                {% if active_tab == 'account' %}
                    <!-- Account Tab -->
                    <div class="max-w-2xl">
                        <div class="bg-base-100 border border-base-300 rounded-lg shadow-sm overflow-hidden">
                            <div class="bg-gradient-to-r from-success-50 dark:from-success-900/20 to-success-100 dark:to-success-800/20 p-4 border-b border-base-300">
                                <h3 class="text-lg font-semibold flex items-center gap-2">
                                    <i class="fa-solid fa-info-circle text-success-600 dark:text-success-400"></i>
                                    Account Information
                                </h3>
                            </div>
                            <div class="p-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div class="space-y-1">
                                        <label class="text-sm font-medium text-base-content/80">Username</label>
                                        <p class="text-base-content font-medium">{{ user.get_display_name() }}</p>
                                    </div>
                                    
                                    {% if user.primary_email %}
                                    <div class="space-y-1">
                                        <label class="text-sm font-medium text-base-content/80">Email</label>
                                        <p class="text-base-content font-medium">{{ user.primary_email }}</p>
                                    </div>
                                    {% endif %}
                                    
                                    <div class="space-y-1">
                                        <label class="text-sm font-medium text-base-content/80">Account Created</label>
                                        <p class="text-base-content font-medium">{{ user.created_at.strftime('%B %d, %Y at %I:%M %p') if user.created_at else 'Unknown' }}</p>
                                    </div>
                                    
                                    <div class="space-y-1">
                                        <label class="text-sm font-medium text-base-content/80">Account Type</label>
                                        <p class="text-base-content font-medium">Local User Account</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                
                {% elif active_tab == 'security' %}
                    <!-- Security Tab -->
                    <div class="max-w-2xl">
                        <div class="bg-base-100 border border-base-300 rounded-lg shadow-sm overflow-hidden">
                            <div class="bg-gradient-to-r from-warning-50 dark:from-warning-900/20 to-warning-100 dark:to-warning-800/20 p-4 border-b border-base-300">
                                <h3 class="text-lg font-semibold flex items-center gap-2">
                                    <i class="fa-solid fa-key text-warning-600 dark:text-warning-400"></i>
                                    Change Password
                                </h3>
                            </div>
                            <div class="p-6">
                                <form method="POST" class="space-y-4">
                                    {{ change_password_form.hidden_tag() }}
                                    <input type="hidden" name="form_type" value="change_password">
                                    
                                    <div class="form-control">
                                        {{ change_password_form.current_password.label(class="label") }}
                                        {{ change_password_form.current_password(class="input input-bordered " + ("input-error" if change_password_form.current_password.errors else "")) }}
                                        {% if change_password_form.current_password.errors %}
                                            {% for error in change_password_form.current_password.errors %}
                                                <label class="label"><span class="label-text-alt text-error">{{ error }}</span></label>
                                            {% endfor %}
                                        {% endif %}
                                    </div>
                                    
                                    <div class="form-control">
                                        {{ change_password_form.new_password.label(class="label") }}
                                        {{ change_password_form.new_password(class="input input-bordered " + ("input-error" if change_password_form.new_password.errors else "")) }}
                                        {% if change_password_form.new_password.errors %}
                                            {% for error in change_password_form.new_password.errors %}
                                                <label class="label"><span class="label-text-alt text-error">{{ error }}</span></label>
                                            {% endfor %}
                                        {% endif %}
                                    </div>
                                    
                                    <div class="form-control">
                                        {{ change_password_form.confirm_new_password.label(class="label") }}
                                        {{ change_password_form.confirm_new_password(class="input input-bordered " + ("input-error" if change_password_form.confirm_new_password.errors else "")) }}
                                        {% if change_password_form.confirm_new_password.errors %}
                                            {% for error in change_password_form.confirm_new_password.errors %}
                                                <label class="label"><span class="label-text-alt text-error">{{ error }}</span></label>
                                            {% endfor %}
                                        {% endif %}
                                    </div>
                                    
                                    <div class="flex justify-end">
                                        {{ change_password_form.submit_change_password(class="btn btn-warning") }}
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                
                {% elif active_tab == 'preferences' %}
                    <!-- Preferences Tab -->
                    <div class="max-w-2xl">
                        <div class="bg-base-100 border border-base-300 rounded-lg shadow-sm overflow-hidden">
                            <div class="bg-gradient-to-r from-info-50 dark:from-info-900/20 to-info-100 dark:to-info-800/20 p-4 border-b border-base-300">
                                <h3 class="text-lg font-semibold flex items-center gap-2">
                                    <i class="fa-solid fa-clock text-info-600 dark:text-info-400"></i>
                                    Timezone & Time Format
                                </h3>
                            </div>
                            <div class="p-6">
                                <form method="POST" class="space-y-4">
                                    {{ timezone_form.hidden_tag() }}
                                    <input type="hidden" name="form_type" value="timezone">
                                    
                                    <div class="form-control">
                                        {{ timezone_form.timezone_preference.label(class="label") }}
                                        {{ timezone_form.timezone_preference(class="select select-bordered " + ("select-error" if timezone_form.timezone_preference.errors else "")) }}
                                        {% if timezone_form.timezone_preference.errors %}
                                            {% for error in timezone_form.timezone_preference.errors %}
                                                <label class="label"><span class="label-text-alt text-error">{{ error }}</span></label>
                                            {% endfor %}
                                        {% endif %}
                                    </div>
                                    
                                    <div class="form-control" id="local-timezone-field" style="display: none;">
                                        {{ timezone_form.local_timezone.label(class="label") }}
                                        {{ timezone_form.local_timezone(class="input input-bordered") }}
                                    </div>
                                    
                                    <div class="form-control">
                                        {{ timezone_form.time_format.label(class="label") }}
                                        {{ timezone_form.time_format(class="select select-bordered " + ("select-error" if timezone_form.time_format.errors else "")) }}
                                        {% if timezone_form.time_format.errors %}
                                            {% for error in timezone_form.time_format.errors %}
                                                <label class="label"><span class="label-text-alt text-error">{{ error }}</span></label>
                                            {% endfor %}
                                        {% endif %}
                                    </div>
                                    
                                    <div class="flex justify-end">
                                        {{ timezone_form.submit(class="btn btn-info") }}
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const timezoneSelect = document.getElementById('timezone_preference');
    const localTimezoneField = document.getElementById('local-timezone-field');
    
    function toggleLocalTimezoneField() {
        if (timezoneSelect.value === 'local') {
            localTimezoneField.style.display = 'block';
        } else {
            localTimezoneField.style.display = 'none';
        }
    }
    
    timezoneSelect.addEventListener('change', toggleLocalTimezoneField);
    toggleLocalTimezoneField(); // Initial call
});
</script>
{% endblock %}