<!-- File: app/templates/users/_partials/reset_password_modal.html -->
<!-- Header -->
<div class="flex items-center justify-between p-6 border-b border-base-300">
    <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-full bg-warning/20 flex items-center justify-center">
            <i class="fa-solid fa-key text-warning text-lg"></i>
        </div>
        <div>
            <h3 class="text-xl font-semibold text-base-content">Reset Password</h3>
            <p class="text-sm text-base-content/60">Set a new password for {{ user.get_display_name() }}</p>
        </div>
    </div>
    <form method="dialog">
        <button class="btn btn-sm btn-circle btn-ghost hover:bg-base-200">
            <i class="fa-solid fa-times"></i>
        </button>
    </form>
</div>

<!-- Content -->
<div class="p-6">
    <div class="bg-warning/10 border border-warning/20 rounded-lg p-4 mb-6">
        <div class="flex items-start gap-3">
            <div class="w-6 h-6 rounded-full bg-warning/20 flex items-center justify-center flex-shrink-0 mt-0.5">
                <i class="fa-solid fa-triangle-exclamation text-warning text-xs"></i>
            </div>
            <div>
                <h4 class="font-medium text-warning mb-1">Security Notice</h4>
                <p class="text-sm text-base-content/80 leading-relaxed">
                    The user will need to log in with their new password. Make sure to communicate the new password securely.
                </p>
            </div>
        </div>
    </div>

    <form hx-post="{{ url_for('user.reset_app_user_password', username=user.username) }}"
          hx-target="this"
          hx-swap="outerHTML"
          hx-indicator="#user_reset_password_loader"
          hx-on::after-request="if(event.detail.successful) { document.getElementById('user_reset_password_modal').close(); }">

        {{ form.csrf_token(id=false) }}
        <div class="form-control">
            {{ form.new_password.label(class="label") }}
            {{ form.new_password(class="input input-bordered " + ("input-error" if form.new_password.errors else "")) }}
            {% if form.new_password.errors %}
                {% for error in form.new_password.errors %}
                    <p class="text-error text-xs mt-1">{{ error }}</p>
                {% endfor %}
            {% endif %}
        </div>
        <div class="form-control mt-4">
            {{ form.confirm_new_password.label(class="label") }}
            {{ form.confirm_new_password(class="input input-bordered " + ("input-error" if form.confirm_new_password.errors else "")) }}
            {% if form.confirm_new_password.errors %}
                {% for error in form.confirm_new_password.errors %}
                    <p class="text-error text-xs mt-1">{{ error }}</p>
                {% endfor %}
            {% endif %}
        </div>
        <div class="modal-action mt-6">
            <button type="button" class="btn btn-ghost" onclick="user_reset_password_modal.close()">Cancel</button>
            {{ form.submit_reset_password(class="btn btn-warning") }}
            <span id="user_reset_password_loader" class="htmx-indicator loading loading-spinner loading-xs"></span>
        </div>
    </form>
</div>