<!-- File: app/templates/user/index.html -->
{% extends "base.html" %}

{% block title %}{{ super() }} - {{ title }}{% endblock %}

{% block content %}
<!-- Profile -->
{# Determine service-specific colors and gradients #}
{# Check if this is a local user first #}
{% if is_local_user is defined and is_local_user %}
    {% set primary_service = None %}
    {% set service_types = [] %}
{% else %}
    {% set service_types = user_service_types.get(user.uuid, []) %}
    {% set primary_service = service_types[0] if service_types else None %}
{% endif %}
{% if primary_service %}
    {% if primary_service.value == 'plex' %}
        {% set header_gradient = "bg-gradient-to-r from-plex/10 to-plex/20" %}
        {% set service_color = "plex" %}
        {% set service_icon = "fa-brands fa-plex" %}
        {% set service_name = "Plex" %}
    {% elif primary_service.value == 'jellyfin' %}
        {% set header_gradient = "bg-gradient-to-r from-jellyfin/10 to-jellyfin/20" %}
        {% set service_color = "jellyfin" %}
        {% set service_icon = "fa-solid fa-cube" %}
        {% set service_name = "Jellyfin" %}
    {% elif primary_service.value == 'emby' %}
        {% set header_gradient = "bg-gradient-to-r from-emby/10 to-emby/20" %}
        {% set service_color = "emby" %}
        {% set service_icon = "fa-solid fa-play-circle" %}
        {% set service_name = "Emby" %}
    {% elif primary_service.value == 'kavita' %}
        {% set header_gradient = "bg-gradient-to-r from-kavita/10 to-kavita/20" %}
        {% set service_color = "kavita" %}
        {% set service_icon = "fa-solid fa-book" %}
        {% set service_name = "Kavita" %}
    {% elif primary_service.value == 'audiobookshelf' %}
        {% set header_gradient = "bg-gradient-to-r from-audiobookshelf/10 to-audiobookshelf/20" %}
        {% set service_color = "audiobookshelf" %}
        {% set service_icon = "fa-solid fa-headphones" %}
        {% set service_name = "AudiobookShelf" %}
    {% elif primary_service.value == 'komga' %}
        {% set header_gradient = "bg-gradient-to-r from-komga/10 to-komga/20" %}
        {% set service_color = "komga" %}
        {% set service_icon = "fa-solid fa-book-open" %}
        {% set service_name = "Komga" %}
    {% elif primary_service.value == 'romm' %}
        {% set header_gradient = "bg-gradient-to-r from-romm/10 to-romm/20" %}
        {% set service_color = "romm" %}
        {% set service_icon = "fa-solid fa-gamepad" %}
        {% set service_name = "RomM" %}
    {% else %}
        {% set header_gradient = "bg-gradient-to-r from-primary/10 to-secondary/10" %}
        {% set service_color = "primary" %}
        {% set service_icon = "fa-solid fa-user" %}
        {% set service_name = "Unknown Service" %}
    {% endif %}
{% else %}
    {% set header_gradient = "bg-gradient-to-r from-primary/10 to-secondary/10" %}
    {% set service_color = "primary" %}
    {% set service_icon = "fa-solid fa-user" %}
    {% set service_name = "No Service" %}
{% endif %}

<div class="min-h-screen bg-base-100">
    <!-- Back Navigation -->
    <div class="container mx-auto px-4 py-4">
        {% set back_url = request.args.get('back') %}
        {% set back_view = request.args.get('back_view') %}
        {% if back_url == 'streaming' %}
            <a href="{{ url_for('streaming.index') }}" class="btn btn-ghost btn-sm">
                <i class="fa-solid fa-arrow-left"></i> Back to Streaming
            </a>
        {% elif back_url == 'users' %}
            {% if back_view %}
                <a href="{{ url_for('users.list_users', view=back_view) }}" class="btn btn-ghost btn-sm">
                    <i class="fa-solid fa-arrow-left"></i> Back to Users
                </a>
            {% else %}
                <a href="{{ url_for('users.list_users') }}" class="btn btn-ghost btn-sm">
                    <i class="fa-solid fa-arrow-left"></i> Back to Users
                </a>
            {% endif %}
        {% else %}
            <a href="{{ url_for('users.list_users') }}" class="btn btn-ghost btn-sm">
                <i class="fa-solid fa-arrow-left"></i> Back to Users
            </a>
        {% endif %}
    </div>

    <!-- Main Content Card -->
    <div class="container mx-auto px-4 pb-8 max-w-5xl">
        <div class="bg-base-100 border border-base-300 rounded-xl shadow-lg overflow-hidden">
            <!-- Hero Header Section -->
            <div class="{{ header_gradient }} p-8 text-center border-b border-base-300">
                <div class="flex flex-col items-center space-y-4">
                    <!-- Avatar -->
                    <div class="avatar">
                        <div class="w-24 h-24 rounded-full ring-4 ring-primary/30 ring-offset-4 ring-offset-base-100">
                            {% if user.avatar_url %}
                                <img src="{{ user.avatar_url }}" 
                                     alt="{{ user.get_display_name() }}"
                                     class="w-24 h-24 rounded-full object-cover"
                                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <!-- Fallback colored avatar -->
                                <div class="w-24 h-24 rounded-full flex items-center justify-center text-3xl font-normal text-white" style="display: none;
                                    {% if primary_service and primary_service.value == 'plex' %}background-color: var(--color-plex, #e5a00d);
                                    {% elif primary_service and primary_service.value == 'jellyfin' %}background-color: var(--color-jellyfin, #00a4dc);
                                    {% elif primary_service and primary_service.value == 'emby' %}background-color: var(--color-emby, #52b54b);
                                    {% elif primary_service and primary_service.value == 'kavita' %}background-color: var(--color-kavita, #f39c12);
                                    {% elif primary_service and primary_service.value == 'audiobookshelf' %}background-color: var(--color-audiobookshelf, #8b5cf6);
                                    {% elif primary_service and primary_service.value == 'komga' %}background-color: var(--color-komga, #ef4444);
                                    {% elif primary_service and primary_service.value == 'romm' %}background-color: var(--color-romm, #10b981);
                                    {% else %}background-color: var(--color-primary, #3b82f6);
                                    {% endif %}">
                                    {{ user.get_display_name()[0]|upper if user.get_display_name() else 'U' }}
                                </div>
                            {% else %}
                                {# Fallback to colored circular avatars with service-specific colors when no avatar URL #}
                                {% if primary_service and primary_service.value == 'plex' %}
                                    <div class="bg-plex text-white w-24 h-24 rounded-full flex items-center justify-center text-3xl font-normal">
                                        {{ user.get_display_name()[0]|upper if user.get_display_name() else 'P' }}
                                    </div>
                                {% elif primary_service and primary_service.value == 'jellyfin' %}
                                    <div class="bg-jellyfin text-white w-24 h-24 rounded-full flex items-center justify-center text-3xl font-normal">
                                        {{ user.get_display_name()[0]|upper if user.get_display_name() else 'J' }}
                                    </div>
                                {% elif primary_service and primary_service.value == 'emby' %}
                                    <div class="bg-emby text-white w-24 h-24 rounded-full flex items-center justify-center text-3xl font-normal">
                                        {{ user.get_display_name()[0]|upper if user.get_display_name() else 'E' }}
                                    </div>
                                {% elif primary_service and primary_service.value == 'kavita' %}
                                    <div class="bg-kavita text-white w-24 h-24 rounded-full flex items-center justify-center text-3xl font-normal">
                                        {{ user.get_display_name()[0]|upper if user.get_display_name() else 'K' }}
                                    </div>
                                {% elif primary_service and primary_service.value == 'audiobookshelf' %}
                                    <div class="bg-audiobookshelf text-white w-24 h-24 rounded-full flex items-center justify-center text-3xl font-normal">
                                        {{ user.get_display_name()[0]|upper if user.get_display_name() else 'A' }}
                                    </div>
                            {% elif primary_service and primary_service.value == 'komga' %}
                                <div class="bg-komga text-white w-24 h-24 rounded-full flex items-center justify-center text-3xl font-normal">
                                    {{ user.get_display_name()[0]|upper if user.get_display_name() else 'K' }}
                                </div>
                            {% elif primary_service and primary_service.value == 'romm' %}
                                <div class="bg-romm text-white w-24 h-24 rounded-full flex items-center justify-center text-3xl font-normal">
                                    {{ user.get_display_name()[0]|upper if user.get_display_name() else 'R' }}
                                </div>
                            {% else %}
                                <div class="bg-gray-500 text-white w-24 h-24 rounded-full flex items-center justify-center text-3xl font-normal">
                                    {{ user.get_display_name()[0]|upper if user.get_display_name() else 'U' }}
                                </div>
                            {% endif %}
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- User Info -->
                    <div>
                        <h1 class="text-3xl font-bold text-base-content mb-2">{{ user.get_display_name() }}</h1>
                        <div class="flex items-center justify-center gap-2 flex-wrap">
                            {% if is_local_user is defined and is_local_user %}
                                <span class="inline-flex items-center rounded-md bg-primary/10 px-3 py-1 text-sm font-medium text-primary ring-1 ring-inset ring-primary/20 gap-2">
                                    <i class="fa-solid fa-user w-4 h-4"></i>
                                    Local Account
                                </span>
                                
                                {# Show badges for linked service accounts #}
                                {% if user.media_accesses %}
                                    {% for media_access in user.media_accesses %}
                                        {% set service_type = media_access.get_service_type() %}
                                        {% if service_type == 'plex' %}
                                            <a href="{{ url_for('user.view_service_account', server_nickname=media_access.server.server_nickname, server_username=media_access.external_username, back='users', back_view=request.args.get('back_view', 'cards')) }}" class="inline-flex items-center rounded-md bg-plex-50 dark:bg-plex-400/10 px-3 py-1 text-sm font-medium text-plex-700 dark:text-plex-400 ring-1 ring-inset ring-plex-600/20 dark:ring-plex-500/20 gap-2 hover:bg-plex-100 dark:hover:bg-plex-400/20 transition-colors cursor-pointer">
                                                <svg class="w-4 h-4" viewBox="0 0 192 192" xmlns="http://www.w3.org/2000/svg" fill="currentColor"><path d="M22 25.5h48L116 94l-46 68.5H22L68.5 94Zm109.8 56L108 46l14-20.5h48zm-.3 23.5c10.979 17.625 25.52 38.875 38.5 49.5-11.149 13.635-34.323 32.278-62.5-14z"/></svg>
                                                {{ media_access.get_display_name() }}
                                            </a>
                                        {% elif service_type == 'jellyfin' %}
                                            <a href="{{ url_for('user.view_service_account', server_nickname=media_access.server.server_nickname, server_username=media_access.external_username, back='users', back_view=request.args.get('back_view', 'cards')) }}" class="inline-flex items-center rounded-md bg-jellyfin-50 dark:bg-jellyfin-400/10 px-3 py-1 text-sm font-medium text-jellyfin-700 dark:text-jellyfin-400 ring-1 ring-inset ring-jellyfin-600/20 dark:ring-jellyfin-500/20 gap-2 hover:bg-jellyfin-100 dark:hover:bg-jellyfin-400/20 transition-colors cursor-pointer">
                                                <i class="fa-solid fa-cube w-4 h-4"></i>
                                                {{ media_access.get_display_name() }}
                                            </a>
                                        {% elif service_type == 'emby' %}
                                            <a href="{{ url_for('user.view_service_account', server_nickname=media_access.server.server_nickname, server_username=media_access.external_username, back='users', back_view=request.args.get('back_view', 'cards')) }}" class="inline-flex items-center rounded-md bg-emby-50 dark:bg-emby-400/10 px-3 py-1 text-sm font-medium text-emby-700 dark:text-emby-400 ring-1 ring-inset ring-emby-600/20 dark:ring-emby-500/20 gap-2 hover:bg-emby-100 dark:hover:bg-emby-400/20 transition-colors cursor-pointer">
                                                <i class="fa-solid fa-play-circle w-4 h-4"></i>
                                                {{ media_access.get_display_name() }}
                                            </a>
                                        {% elif service_type == 'kavita' %}
                                            <a href="{{ url_for('user.view_service_account', server_nickname=media_access.server.server_nickname, server_username=media_access.external_username, back='users', back_view=request.args.get('back_view', 'cards')) }}" class="inline-flex items-center rounded-md bg-kavita-50 dark:bg-kavita-400/10 px-3 py-1 text-sm font-medium text-kavita-700 dark:text-kavita-400 ring-1 ring-inset ring-kavita-600/20 dark:ring-kavita-500/20 gap-2 hover:bg-kavita-100 dark:hover:bg-kavita-400/20 transition-colors cursor-pointer">
                                                <i class="fa-solid fa-book w-4 h-4"></i>
                                                {{ media_access.get_display_name() }}
                                            </a>
                                        {% elif service_type == 'audiobookshelf' %}
                                            <a href="{{ url_for('user.view_service_account', server_nickname=media_access.server.server_nickname, server_username=media_access.external_username, back='users', back_view=request.args.get('back_view', 'cards')) }}" class="inline-flex items-center rounded-md bg-audiobookshelf-50 dark:bg-audiobookshelf-400/10 px-3 py-1 text-sm font-medium text-audiobookshelf-700 dark:text-audiobookshelf-400 ring-1 ring-inset ring-audiobookshelf-600/20 dark:ring-audiobookshelf-500/20 gap-2 hover:bg-audiobookshelf-100 dark:hover:bg-audiobookshelf-400/20 transition-colors cursor-pointer">
                                                <i class="fa-solid fa-headphones w-4 h-4"></i>
                                                {{ media_access.get_display_name() }}
                                            </a>
                                        {% elif service_type == 'komga' %}
                                            <a href="{{ url_for('user.view_service_account', server_nickname=media_access.server.server_nickname, server_username=media_access.external_username, back='users', back_view=request.args.get('back_view', 'cards')) }}" class="inline-flex items-center rounded-md bg-komga-50 dark:bg-komga-400/10 px-3 py-1 text-sm font-medium text-komga-700 dark:text-komga-400 ring-1 ring-inset ring-komga-600/20 dark:ring-komga-500/20 gap-2 hover:bg-komga-100 dark:hover:bg-komga-400/20 transition-colors cursor-pointer">
                                                <i class="fa-solid fa-book-open w-4 h-4"></i>
                                                {{ media_access.get_display_name() }}
                                            </a>
                                        {% elif service_type == 'romm' %}
                                            <a href="{{ url_for('user.view_service_account', server_nickname=media_access.server.server_nickname, server_username=media_access.external_username, back='users', back_view=request.args.get('back_view', 'cards')) }}" class="inline-flex items-center rounded-md bg-romm-50 dark:bg-romm-400/10 px-3 py-1 text-sm font-medium text-romm-700 dark:text-romm-400 ring-1 ring-inset ring-romm-600/20 dark:ring-romm-500/20 gap-2 hover:bg-romm-100 dark:hover:bg-romm-400/20 transition-colors cursor-pointer">
                                                <i class="fa-solid fa-gamepad w-4 h-4"></i>
                                                {{ media_access.get_display_name() }}
                                            </a>
                                        {% else %}
                                            <a href="{{ url_for('user.view_service_account', server_nickname=media_access.server.server_nickname, server_username=media_access.external_username, back='users', back_view=request.args.get('back_view', 'cards')) }}" class="inline-flex items-center rounded-md bg-gray-50 dark:bg-gray-400/10 px-3 py-1 text-sm font-medium text-gray-700 dark:text-gray-400 ring-1 ring-inset ring-gray-600/20 dark:ring-gray-500/20 gap-2 hover:bg-gray-100 dark:hover:bg-gray-400/20 transition-colors cursor-pointer">
                                                <i class="fa-solid fa-server w-4 h-4"></i>
                                                {{ media_access.get_display_name() }}
                                            </a>
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                            {% else %}
                                {% set user_servers = user_server_names.get(user.uuid, []) %}
                                {% if user_servers %}
                                    <span class="inline-flex items-center rounded-md bg-{{ service_color }}-50 dark:bg-{{ service_color }}-400/10 px-3 py-1 text-sm font-medium text-{{ service_color }}-700 dark:text-{{ service_color }}-400 ring-1 ring-inset ring-{{ service_color }}-600/20 dark:ring-{{ service_color }}-500/20 gap-2">
                                        {% if primary_service and primary_service.value == 'plex' %}
                                            <svg class="w-4 h-4" viewBox="0 0 192 192" xmlns="http://www.w3.org/2000/svg" fill="currentColor" stroke="transparent" stroke-linejoin="round" stroke-width="12"><path d="M22 25.5h48L116 94l-46 68.5H22L68.5 94Zm109.8 56L108 46l14-20.5h48zm-.3 23.5c10.979 17.625 25.52 38.875 38.5 49.5-11.149 13.635-34.323 32.278-62.5-14z"/></svg>
                                        {% else %}
                                            <i class="{{ service_icon }} w-4 h-4"></i>
                                        {% endif %}
                                        {{ user_servers[0] }} User
                                    </span>
                                {% else %}
                                    <span class="inline-flex items-center rounded-md bg-{{ service_color }}-50 dark:bg-{{ service_color }}-400/10 px-3 py-1 text-sm font-medium text-{{ service_color }}-700 dark:text-{{ service_color }}-400 ring-1 ring-inset ring-{{ service_color }}-600/20 dark:ring-{{ service_color }}-500/20 gap-2">
                                        {% if primary_service and primary_service.value == 'plex' %}
                                            <svg class="w-4 h-4" viewBox="0 0 192 192" xmlns="http://www.w3.org/2000/svg" fill="currentColor" stroke="transparent" stroke-linejoin="round" stroke-width="12"><path d="M22 25.5h48L116 94l-46 68.5H22L68.5 94Zm109.8 56L108 46l14-20.5h48zm-.3 23.5c10.979 17.625 25.52 38.875 38.5 49.5-11.149 13.635-34.323 32.278-62.5-14z"/></svg>
                                        {% else %}
                                            <i class="{{ service_icon }} w-4 h-4"></i>
                                        {% endif %}
                                        {{ service_name }} User
                                    </span>
                                {% endif %}
                                
                                {# Show linked UserAppAccess badge if this service user is linked to a local account #}
                                {% if linked_user_app_access %}
                                    <a href="{{ url_for('user.view_app_user', username=linked_user_app_access.username, back='users', back_view=request.args.get('back_view', 'cards')) }}" 
                                       class="inline-flex items-center rounded-md bg-primary/10 px-3 py-1 text-sm font-medium text-primary ring-1 ring-inset ring-primary/20 gap-2 hover:bg-primary/20 transition-colors cursor-pointer">
                                        <i class="fa-solid fa-link w-4 h-4"></i>
                                        {{ linked_user_app_access.get_display_name() }}
                                    </a>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Navigation Tabs -->
            <div class="overflow-x-auto border-b border-base-300">
                <div role="tablist" class="tabs tabs-border whitespace-nowrap flex-nowrap">
                    {% set tab_params = {} %}
                    {% if request.args.get('back') %}{% set _ = tab_params.update({'back': request.args.get('back')}) %}{% endif %}
                    {% if request.args.get('back_view') %}{% set _ = tab_params.update({'back_view': request.args.get('back_view')}) %}{% endif %}
                    
                    {# Determine the correct route based on user type #}
                    {% if is_local_user is defined and is_local_user %}
                        {# Local User - use username route #}
                        <a role="tab" href="{{ url_for('user.view_app_user', username=user.username, tab='profile', **tab_params) }}" class="tab block h-[unset] pb-4 pt-4 pl-2.5 pr-2.5 {{ 'tab-active' if active_tab == 'profile' else '' }}">
                            <i class="fa-solid fa-user mr-2"></i>Profile
                        </a>
                        <a role="tab" href="{{ url_for('user.view_app_user', username=user.username, tab='history', **tab_params) }}" class="tab block h-[unset] pb-4 pt-4 pl-2.5 pr-2.5 {{ 'tab-active' if active_tab == 'history' else '' }}">
                            <i class="fa-solid fa-clock-rotate-left mr-2"></i>History
                        </a>
                        <a role="tab" href="{{ url_for('user.view_app_user', username=user.username, tab='settings', **tab_params) }}" class="tab block h-[unset] pb-4 pt-4 pl-2.5 pr-2.5 {{ 'tab-active' if active_tab == 'settings' else '' }}">
                            <i class="fa-solid fa-cog mr-2"></i>Settings
                        </a>
                        <a role="tab" href="{{ url_for('user.view_app_user', username=user.username, tab='security', **tab_params) }}" class="tab block h-[unset] pb-4 pt-4 pl-2.5 pr-2.5 {{ 'tab-active' if active_tab == 'security' else '' }}">
                            <i class="fa-solid fa-shield-alt mr-2"></i>Security
                        </a>
                    {% else %}
                        {# Service Account - use server/username route #}
                        {% set user_servers = user_server_names.get(user.uuid, []) %}
                        {% if user_servers %}
                            {% set server_name = user_servers[0] %}
                            {% set username = user.get_display_name() %}
                            <a role="tab" href="{{ url_for('user.view_service_account', server_nickname=server_name, server_username=username, tab='profile', **tab_params) }}" class="tab block h-[unset] pb-4 pt-4 pl-2.5 pr-2.5 {{ 'tab-active' if active_tab == 'profile' else '' }}">
                                <i class="fa-solid fa-user mr-2"></i>Profile
                            </a>
                            <a role="tab" href="{{ url_for('user.view_service_account', server_nickname=server_name, server_username=username, tab='history', **tab_params) }}" class="tab block h-[unset] pb-4 pt-4 pl-2.5 pr-2.5 {{ 'tab-active' if active_tab == 'history' else '' }}">
                                <i class="fa-solid fa-clock-rotate-left mr-2"></i>History
                            </a>
                            <a role="tab" href="{{ url_for('user.view_service_account', server_nickname=server_name, server_username=username, tab='settings', **tab_params) }}" class="tab block h-[unset] pb-4 pt-4 pl-2.5 pr-2.5 {{ 'tab-active' if active_tab == 'settings' else '' }}">
                                <i class="fa-solid fa-cog mr-2"></i>Settings
                            </a>
                            {% if primary_service and primary_service.value == 'plex' %}
                            <a role="tab" href="{{ url_for('user.view_service_account', server_nickname=server_name, server_username=username, tab='overseerr', **tab_params) }}" class="tab block h-[unset] pb-4 pt-4 pl-2.5 pr-2.5 {{ 'tab-active' if active_tab == 'overseerr' else '' }}">
                                <i class="fa-solid fa-film mr-2" style="color: #a855f7;"></i>Overseerr
                            </a>
                            {% endif %}
                            {% if user.password_hash and user.used_invite_id %}
                            <a role="tab" href="{{ url_for('user.view_service_account', server_nickname=server_name, server_username=username, tab='security', **tab_params) }}" class="tab block h-[unset] pb-4 pt-4 pl-2.5 pr-2.5 {{ 'tab-active' if active_tab == 'security' else '' }}">
                                <i class="fa-solid fa-shield-alt mr-2"></i>Security
                            </a>
                            {% endif %}
                        {% else %}
                            {# Fallback - no server info available #}
                            <span class="tab tab-disabled">
                                <i class="fa-solid fa-exclamation-triangle mr-2"></i>No Server Info
                            </span>
                        {% endif %}
                    {% endif %}
                </div>
            </div>

            <!-- Tab Content -->
            <div class="p-6">
                {% if active_tab == 'profile' %}
                    {% include 'user/partials/profile_tab.html' %}
                {% elif active_tab == 'history' %}
                    {% if is_service_user and server %}
                        <div id="user-history-container" 
                             hx-get="{{ url_for('user.view_service_account', server_nickname=server.server_nickname, server_username=user.username, tab='history') }}"
                             hx-trigger="load"
                             hx-indicator="#loading-spinner">
                            <div class="flex justify-center items-center py-8">
                                <span class="loading loading-spinner loading-md"></span>
                                <span class="ml-2">Loading history...</span>
                            </div>
                        </div>
                    {% elif not is_service_user %}
                        {% include 'user/partials/local_history_tab.html' %}
                    {% else %}
                        {% include 'user/partials/history_tab.html' %}
                    {% endif %}
                {% elif active_tab == 'settings' %}
                    {% if is_service_user %}
                        {% include 'user/partials/settings_tab.html' %}
                    {% else %}
                        {% include 'user/partials/local_settings_tab.html' %}
                    {% endif %}
                {% elif active_tab == 'overseerr' %}
                    {% include 'user/partials/overseerr_tab.html' %}
                {% elif active_tab == 'security' %}
                    {% include 'user/partials/security_tab.html' %}
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Reset Password Modal -->
<dialog id="user_reset_password_modal" class="modal">
    <div class="modal-box max-w-md">
        <form method="dialog"><button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2" onclick="document.getElementById('user_reset_password_modal').close()">✕</button></form>
        <div id="user_reset_password_modal_content">
            <!-- Modal content will be loaded here -->
        </div>
    </div>
</dialog>
{% endblock %}