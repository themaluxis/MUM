{# Sync Section Component (Added/Updated/Removed Users) #}
{# Parameters: section_type ('added', 'updated', 'removed'), sync_result, section_data #}

{% set section_configs = {
    'added': {
        'title': 'Added Users',
        'icon': 'fa-user-plus',
        'color': 'success',
        'description': 'new users were added'
    },
    'updated': {
        'title': 'Updated Users', 
        'icon': 'fa-user-pen',
        'color': 'warning',
        'description': 'users were updated'
    },
    'removed': {
        'title': 'Removed Users',
        'icon': 'fa-user-minus', 
        'color': 'error',
        'description': 'users were removed'
    }
} %}

{% set config = section_configs[section_type] %}
{% set count = sync_result[section_type] %}
{% set grouped_data = sync_result['grouped_' + section_type + '_details'] %}

{% if count > 0 %}
<!-- {{ config.title }} Card -->
<div class="bg-base-200 border border-base-300 rounded-lg overflow-hidden">
    <div class="p-4 border-b border-base-300 cursor-pointer" onclick="toggleCollapse('{{ section_type }}-users')">
        <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-full bg-{{ config.color }}/20 flex items-center justify-center">
                    <i class="fa-solid {{ config.icon }} text-{{ config.color }} text-sm"></i>
                </div>
                <div>
                    <h4 class="font-medium text-{{ config.color }}">{{ config.title }}</h4>
                    <p class="text-xs text-base-content/60">{{ count }} {{ config.description }}</p>
                </div>
            </div>
            <i class="fa-solid fa-chevron-down text-base-content/60 transition-transform" id="{{ section_type }}-users-icon"></i>
        </div>
    </div>
    <div class="p-4 bg-base-300/50" id="{{ section_type }}-users" style="display: block;">
        {% if grouped_data %}
            <div class="space-y-3">
                {% for detail in grouped_data %}
                    {% if detail.type == 'linked_group' %}
                        {% include 'users/_partials/sync_linked_group.html' with context %}
                    {% else %}
                        {% include 'users/_partials/sync_standalone_account.html' with context %}
                    {% endif %}
                {% endfor %}
            </div>
        {% else %}
            <p class="text-xs text-base-content/60">{{ count }} {{ config.description }} from media servers.</p>
        {% endif %}
    </div>
</div>
{% endif %}