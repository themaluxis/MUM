<!-- File: app/templates/libraries/partials/sync_results_modal.html -->
<div class="modal-box w-11/12 max-w-5xl">
    <h3 class="font-bold text-lg mb-4">
        <i class="fa-solid fa-sync-alt mr-2"></i>Library Sync Results
    </h3>
    
    <!-- Summary Stats -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
        <div class="stat bg-base-200 rounded-lg p-3">
            <div class="stat-title text-xs">Servers Synced</div>
            <div class="stat-value text-lg">{{ sync_result.servers_synced }}</div>
        </div>
        <div class="stat bg-success/20 rounded-lg p-3">
            <div class="stat-title text-xs">Added</div>
            <div class="stat-value text-lg text-success">{{ sync_result.libraries_added }}</div>
        </div>
        <div class="stat bg-warning/20 rounded-lg p-3">
            <div class="stat-title text-xs">Updated</div>
            <div class="stat-value text-lg text-warning">{{ sync_result.libraries_updated }}</div>
        </div>
        <div class="stat bg-error/20 rounded-lg p-3">
            <div class="stat-title text-xs">Removed</div>
            <div class="stat-value text-lg text-error">{{ sync_result.libraries_removed }}</div>
        </div>
    </div>

    <!-- Detailed Results -->
    <div class="space-y-4">
        {% if sync_result.added_libraries %}
        <div class="collapse collapse-arrow bg-success/10 border border-success/20">
            <input type="checkbox" checked>
            <div class="collapse-title text-success font-medium">
                <i class="fa-solid fa-plus mr-2"></i>
                Added Libraries ({{ sync_result.added_libraries|length }})
            </div>
            <div class="collapse-content">
                <div class="overflow-x-auto">
                    <table class="table table-zebra table-xs">
                        <thead>
                            <tr>
                                <th>Library Name</th>
                                <th>Server</th>
                                <th>Type</th>
                                <th>Items</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for lib in sync_result.added_libraries %}
                            <tr>
                                <td class="font-semibold">{{ lib.name }}</td>
                                <td>{{ lib.server_name }}</td>
                                <td><span class="badge badge-outline badge-xs">{{ lib.type or 'Unknown' }}</span></td>
                                <td>{{ lib.item_count or 'N/A' }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        {% endif %}

        {% if sync_result.updated_libraries %}
        <div class="collapse collapse-arrow bg-warning/10 border border-warning/20">
            <input type="checkbox">
            <div class="collapse-title text-warning font-medium">
                <i class="fa-solid fa-edit mr-2"></i>
                Updated Libraries ({{ sync_result.updated_libraries|length }})
            </div>
            <div class="collapse-content">
                <div class="overflow-x-auto">
                    <table class="table table-zebra table-xs">
                        <thead>
                            <tr>
                                <th>Library Name</th>
                                <th>Server</th>
                                <th>Changes</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for lib in sync_result.updated_libraries %}
                            <tr>
                                <td class="font-semibold">{{ lib.name }}</td>
                                <td>{{ lib.server_name }}</td>
                                <td>
                                    {% for change in lib.changes %}
                                    <span class="badge badge-warning badge-xs mr-1">{{ change }}</span>
                                    {% endfor %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        {% endif %}

        {% if sync_result.removed_libraries %}
        <div class="collapse collapse-arrow bg-error/10 border border-error/20">
            <input type="checkbox">
            <div class="collapse-title text-error font-medium">
                <i class="fa-solid fa-trash mr-2"></i>
                Removed Libraries ({{ sync_result.removed_libraries|length }})
            </div>
            <div class="collapse-content">
                <div class="overflow-x-auto">
                    <table class="table table-zebra table-xs">
                        <thead>
                            <tr>
                                <th>Library Name</th>
                                <th>Server</th>
                                <th>Reason</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for lib in sync_result.removed_libraries %}
                            <tr>
                                <td class="font-semibold">{{ lib.name }}</td>
                                <td>{{ lib.server_name }}</td>
                                <td><span class="badge badge-error badge-xs">No longer exists on server</span></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        {% endif %}

        {% if sync_result.errors > 0 %}
        <div class="collapse collapse-arrow bg-error/10 border border-error/20">
            <input type="checkbox" {% if sync_result.errors > 0 and not (sync_result.added_libraries or sync_result.updated_libraries or sync_result.removed_libraries) %}checked{% endif %}>
            <div class="collapse-title text-error font-medium">
                <i class="fa-solid fa-exclamation-triangle mr-2"></i>
                Errors ({{ sync_result.errors }})
            </div>
            <div class="collapse-content">
                <div class="space-y-2">
                    {% for error in sync_result.error_messages %}
                    <div class="alert alert-error alert-sm">
                        <i class="fa-solid fa-exclamation-circle"></i>
                        <span>{{ error }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Modal Actions -->
    <div class="modal-action">
        <button class="btn btn-primary" onclick="librarySyncResultModal.close()">
            <i class="fa-solid fa-check mr-2"></i>
            Close
        </button>
    </div>
</div>

<!-- Modal backdrop -->
<form method="dialog" class="modal-backdrop">
    <button>close</button>
</form>