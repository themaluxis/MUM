<!-- File: app/templates/libraries/partials/library_content_sync_results_modal.html -->
<div class="modal-box max-w-3xl bg-base-100 border border-base-300 shadow-2xl p-0">
    <!-- Professional Header -->
    <div class="flex items-center justify-between p-6 border-b border-base-300">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center">
                <i class="fa-solid fa-sync text-primary text-lg"></i>
            </div>
            <div>
                <h3 class="text-xl font-semibold text-base-content">Library Content Sync Results</h3>
                <p class="text-sm text-base-content/60">{{ library_name }} - Review changes made during synchronization</p>
            </div>
        </div>
        <form method="dialog">
            <button class="btn btn-sm btn-circle btn-ghost hover:bg-base-200" type="button" 
                    onclick="document.getElementById('library_content_sync_results_modal').close()">
                <i class="fa-solid fa-times"></i>
            </button>
        </form>
    </div>

    <!-- Content -->
    <div class="p-6">
        <!-- Description Card -->
        <div class="bg-base-200/50 rounded-lg p-4 mb-6 border border-base-300">
            <div class="flex items-start gap-3">
                <div class="w-8 h-8 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0 mt-0.5">
                    <i class="fa-solid fa-info text-primary text-sm"></i>
                </div>
                <div>
                    <h4 class="font-medium text-base-content mb-1">Synchronization Summary</h4>
                    <p class="text-sm text-base-content/70 leading-relaxed">
                        {% if sync_result.get('total_items', 0) == 0 %}
                            No items were found in this library during synchronization.
                        {% elif sync_result.get('added', 0) == 0 and sync_result.get('updated', 0) == 0 and sync_result.get('removed', 0) == 0 %}
                            Library content is synchronized and up to date. No changes were required for {{ sync_result.get('total_items', 0) }} items.
                        {% else %}
                            Library synchronization completed with 
                            {% if sync_result.get('added', 0) > 0 %}<span class="text-success font-medium">{{ sync_result.get('added', 0) }} items added</span>{% endif %}{% if sync_result.get('added', 0) > 0 and (sync_result.get('updated', 0) > 0 or sync_result.get('removed', 0) > 0) %}, {% endif %}
                            {% if sync_result.get('updated', 0) > 0 %}<span class="text-warning font-medium">{{ sync_result.get('updated', 0) }} items updated</span>{% endif %}{% if sync_result.get('updated', 0) > 0 and sync_result.get('removed', 0) > 0 %}, and {% endif %}
                            {% if sync_result.get('removed', 0) > 0 %}<span class="text-error font-medium">{{ sync_result.get('removed', 0) }} items removed</span>{% endif %}
                            out of {{ sync_result.get('total_items', 0) }} total items.
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
            <div class="stat bg-base-200/50 rounded-lg p-4 border border-base-300">
                <div class="stat-title text-xs text-base-content/60">Total Items</div>
                <div class="stat-value text-lg text-base-content">{{ sync_result.get('total_items', 0) }}</div>
            </div>
            <div class="stat bg-success/10 rounded-lg p-4 border border-success/20">
                <div class="stat-title text-xs text-success/80">Added</div>
                <div class="stat-value text-lg text-success">{{ sync_result.get('added', 0) }}</div>
            </div>
            <div class="stat bg-warning/10 rounded-lg p-4 border border-warning/20">
                <div class="stat-title text-xs text-warning/80">Updated</div>
                <div class="stat-value text-lg text-warning">{{ sync_result.get('updated', 0) }}</div>
            </div>
            <div class="stat bg-error/10 rounded-lg p-4 border border-error/20">
                <div class="stat-title text-xs text-error/80">Removed</div>
                <div class="stat-value text-lg text-error">{{ sync_result.get('removed', 0) }}</div>
            </div>
        </div>

        <!-- Detailed Changes -->
        {% if sync_result.get('added_items') or sync_result.get('updated_items') or sync_result.get('removed_items') %}
        <div class="space-y-4 mb-6">
            <!-- Added Items -->
            {% if sync_result.get('added_items') and sync_result.get('added_items')|length > 0 %}
            <div class="bg-success/10 border border-success/20 rounded-lg p-4">
                <div class="flex items-start gap-3">
                    <div class="w-6 h-6 rounded-full bg-success/20 flex items-center justify-center flex-shrink-0 mt-0.5">
                        <i class="fa-solid fa-plus text-success text-xs"></i>
                    </div>
                    <div class="flex-1">
                        <h4 class="font-medium text-success mb-2">Added Items ({{ sync_result.get('added_items')|length }}{% if sync_result.get('added', 0) > 50 %} of {{ sync_result.get('added', 0) }}{% endif %})</h4>
                        <div class="max-h-32 overflow-y-auto">
                            <ul class="text-sm text-base-content/80 space-y-1">
                                {% for item in sync_result.get('added_items', []) %}
                                    <li class="flex items-start gap-2">
                                        <i class="fa-solid fa-circle text-success text-[6px] mt-1.5"></i>
                                        <span class="font-medium">{{ item.title }}</span>
                                        {% if item.year %}<span class="text-base-content/60">({{ item.year }})</span>{% endif %}
                                        <span class="text-xs bg-success/20 text-success px-1 py-0.5 rounded">{{ item.type }}</span>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% if sync_result.get('added', 0) > 50 %}
                        <p class="text-xs text-base-content/60 mt-2">Showing first 50 items. {{ sync_result.get('added', 0) - 50 }} more items were added.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Updated Items -->
            {% if sync_result.get('updated_items') and sync_result.get('updated_items')|length > 0 %}
            <div class="bg-warning/10 border border-warning/20 rounded-lg p-4">
                <div class="flex items-start gap-3">
                    <div class="w-6 h-6 rounded-full bg-warning/20 flex items-center justify-center flex-shrink-0 mt-0.5">
                        <i class="fa-solid fa-edit text-warning text-xs"></i>
                    </div>
                    <div class="flex-1">
                        <h4 class="font-medium text-warning mb-2">Updated Items ({{ sync_result.get('updated_items')|length }}{% if sync_result.get('updated', 0) > 50 %} of {{ sync_result.get('updated', 0) }}{% endif %})</h4>
                        <div class="max-h-32 overflow-y-auto">
                            <ul class="text-sm text-base-content/80 space-y-2">
                                {% for item in sync_result.get('updated_items', []) %}
                                    <li class="flex items-start gap-2">
                                        <i class="fa-solid fa-circle text-warning text-[6px] mt-1.5"></i>
                                        <div class="flex-1">
                                            <div class="flex items-center gap-2">
                                                <span class="font-medium">{{ item.title }}</span>
                                                {% if item.year %}<span class="text-base-content/60">({{ item.year }})</span>{% endif %}
                                                <span class="text-xs bg-warning/20 text-warning px-1 py-0.5 rounded">{{ item.type }}</span>
                                            </div>
                                            {% if item.changes %}
                                            <div class="text-xs text-base-content/60 mt-1">
                                                {% for change in item.changes %}
                                                    <div>â€¢ {{ change }}</div>
                                                {% endfor %}
                                            </div>
                                            {% endif %}
                                        </div>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% if sync_result.get('updated', 0) > 50 %}
                        <p class="text-xs text-base-content/60 mt-2">Showing first 50 items. {{ sync_result.get('updated', 0) - 50 }} more items were updated.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Removed Items -->
            {% if sync_result.get('removed_items') and sync_result.get('removed_items')|length > 0 %}
            <div class="bg-error/10 border border-error/20 rounded-lg p-4">
                <div class="flex items-start gap-3">
                    <div class="w-6 h-6 rounded-full bg-error/20 flex items-center justify-center flex-shrink-0 mt-0.5">
                        <i class="fa-solid fa-minus text-error text-xs"></i>
                    </div>
                    <div class="flex-1">
                        <h4 class="font-medium text-error mb-2">Removed Items ({{ sync_result.get('removed_items')|length }}{% if sync_result.get('removed', 0) > 50 %} of {{ sync_result.get('removed', 0) }}{% endif %})</h4>
                        <div class="max-h-32 overflow-y-auto">
                            <ul class="text-sm text-base-content/80 space-y-1">
                                {% for item in sync_result.get('removed_items', []) %}
                                    <li class="flex items-start gap-2">
                                        <i class="fa-solid fa-circle text-error text-[6px] mt-1.5"></i>
                                        <span class="font-medium">{{ item.title }}</span>
                                        {% if item.year %}<span class="text-base-content/60">({{ item.year }})</span>{% endif %}
                                        <span class="text-xs bg-error/20 text-error px-1 py-0.5 rounded">{{ item.type }}</span>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% if sync_result.get('removed', 0) > 50 %}
                        <p class="text-xs text-base-content/60 mt-2">Showing first 50 items. {{ sync_result.get('removed', 0) - 50 }} more items were removed.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- Error Messages -->
        {% if sync_result.get('errors') and sync_result.get('errors')|length > 0 %}
        <div class="bg-error/10 border border-error/20 rounded-lg p-4 mb-6">
            <div class="flex items-start gap-3">
                <div class="w-6 h-6 rounded-full bg-error/20 flex items-center justify-center flex-shrink-0 mt-0.5">
                    <i class="fa-solid fa-exclamation-triangle text-error text-xs"></i>
                </div>
                <div>
                    <h4 class="font-medium text-error mb-2">Synchronization Errors</h4>
                    <ul class="text-sm text-base-content/80 space-y-1">
                        {% for error in sync_result.get('errors', []) %}
                            <li class="flex items-start gap-2">
                                <i class="fa-solid fa-circle text-error text-[6px] mt-1.5"></i>
                                {{ error }}
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Performance Info -->
        {% if sync_result.get('duration') %}
        <div class="bg-info/10 border border-info/20 rounded-lg p-4">
            <div class="flex items-center gap-3">
                <div class="w-6 h-6 rounded-full bg-info/20 flex items-center justify-center">
                    <i class="fa-solid fa-clock text-info text-xs"></i>
                </div>
                <div>
                    <h4 class="font-medium text-info mb-1">Performance</h4>
                    <p class="text-sm text-base-content/70">
                        Synchronization completed in {{ "%.2f"|format(sync_result.get('duration', 0)) }} seconds
                        {% if sync_result.get('total_items', 0) > 0 %}
                            ({{ "%.1f"|format(sync_result.get('total_items', 0) / sync_result.get('duration', 1)) }} items/second)
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
        {% endif %}

    </div>

    <!-- Action Buttons -->
    <div class="flex items-center justify-end gap-3 p-6 border-t border-base-300">
        <button type="button" class="btn btn-ghost" 
                onclick="document.getElementById('library_content_sync_results_modal').close()">
            <i class="fa-solid fa-times mr-2"></i>
            Close
        </button>
    </div>
</div>

<!-- Modal backdrop -->
<form method="dialog" class="modal-backdrop">
    <button>close</button>
</form>