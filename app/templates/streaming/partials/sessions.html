{# File: app/templates/streaming/partials/sessions.html #}
{# Expects 'sessions' (list of dicts) AND 'summary_stats' (dict) in context #}

{# --- Summary Statistics Line --- #}
{% if summary_stats %}
<div class="text-sm text-base-content/80 mb-3 pb-3 border-b border-base-300/40">
    <i class="fa-solid fa-server fa-fw mr-1"></i>
    <strong>Activity:</strong> Sessions: {{ summary_stats.total_streams }} stream{{ 's' if summary_stats.total_streams != 1 else '' }}
    {% if summary_stats.total_streams > 0 %}
        ({{ summary_stats.direct_play_count }} direct play, {{ summary_stats.transcode_count }} transcode)
        | Bandwidth: {{ summary_stats.total_bandwidth_mbps }} Mbps
        (LAN: {{ summary_stats.lan_bandwidth_mbps }} Mbps, WAN: {{ summary_stats.wan_bandwidth_mbps }} Mbps)
    {% endif %}
    <i class="fa-solid fa-info-circle fa-xs ml-1 text-base-content/50" title="Bandwidth is an estimate based on current stream bitrates."></i>
</div>
{% endif %}
{# --- End Summary Statistics Line --- #}

{% if sessions and sessions|length > 0 %}
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-4">
        {% for session in sessions %}
        <div class="card bg-base-200 shadow-lg w-full max-w-md relative group" tabindex="0">
            <div class="absolute top-2 right-2 z-10 flex space-x-1
                        opacity-0 pointer-events-none 
                        transition-opacity duration-200 
                        group-hover:opacity-100 group-hover:pointer-events-auto 
                        group-focus:opacity-100 group-focus:pointer-events-auto">
                
                <button type="button" class="btn btn-xs btn-circle btn-info" 
                        title="Show Raw Data"
                        onclick="document.getElementById('rawDataModal-{{ session.session_key }}').showModal()">
                    <i class="fa-solid fa-info"></i>
                </button>

                {% if current_user.has_permission('kill_stream') and session.session_key %}
                <button class="btn btn-xs btn-circle btn-error"
                        title="Terminate Session"
                        onclick='openTerminateSessionModal({{ session.session_key | tojson }}, {{ session.user | tojson }}, {{ session.media_title | tojson }}, {{ session.service_type | tojson }}, {{ session.server_name | tojson }})'>
                    <i class="fa-solid fa-times"></i>
                </button>
                {% endif %}
            </div>
            
            <div class="card-body p-3">
                {# Main Flex Container: Poster | Details #}
                <div class="flex items-start space-x-3">
                    {# Poster Column #}
                    <div class="avatar flex-shrink-0">
                        <div class="w-30 h-45 rounded">
                            {% if session.thumb_url %}
                                <img src="{{ session.thumb_url }}" 
                                    alt="{{ session.media_title }} Poster" 
                                    class="w-full h-full object-cover"
                                    loading="lazy"
                                    onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <!-- Fallback when image fails to load -->
                                <div class="w-full h-full bg-base-300 flex flex-col items-center justify-center text-xs text-base-content/50" style="display: none;">
                                        <i class="fa-solid fa-image fa-2x mb-1"></i>
                                        <div>No Poster</div>
                                </div>
                            {% else %}
                                <!-- No image placeholder -->
                                <div class="absolute inset-0 bg-base-300 flex items-center justify-center text-base-content/40">
                                    <i class="fa-solid fa-image text-4xl"></i>
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    {# Original Details Column (Top Part) #}
                    <div class="flex-grow min-w-0">

                        {# User, Player, Media Type - styled as per your preferred layout #}
                        <div class="text-xs space-y-0.5 mt-1">
                            <p class="text-base-content/80 flex items-center" title="{{ session.user }}">
                                {% if session.user_avatar_url %}
                                    <div class="avatar avatar-xs mr-1.5">
                                        <div class="w-4 h-4 rounded-full">
                                            <img src="{{ session.user_avatar_url }}" alt="{{ session.user }} avatar" 
                                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" />
                                            {# Service-aware fallback avatar #}
                                            {% if session.service_type == 'jellyfin' %}
                                                <div class="bg-jellyfin text-white w-4 h-4 rounded-full flex items-center justify-center text-[0.5rem] font-bold" style="display: none;">
                                                    {{ session.user[0]|upper if session.user else 'U' }}
                                                </div>
                                            {% elif session.service_type == 'plex' %}
                                                <div class="bg-plex text-white w-4 h-4 rounded-full flex items-center justify-center text-[0.5rem] font-bold" style="display: none;">
                                                    {{ session.user[0]|upper if session.user else 'U' }}
                                                </div>
                                            {% elif session.service_type == 'emby' %}
                                                <div class="bg-emby text-white w-4 h-4 rounded-full flex items-center justify-center text-[0.5rem] font-bold" style="display: none;">
                                                    {{ session.user[0]|upper if session.user else 'U' }}
                                                </div>
                                            {% elif session.service_type == 'kavita' %}
                                                <div class="bg-kavita text-white w-4 h-4 rounded-full flex items-center justify-center text-[0.5rem] font-bold" style="display: none;">
                                                    {{ session.user[0]|upper if session.user else 'U' }}
                                                </div>
                                            {% elif session.service_type == 'audiobookshelf' %}
                                                <div class="bg-audiobookshelf text-white w-4 h-4 rounded-full flex items-center justify-center text-[0.5rem] font-bold" style="display: none;">
                                                    {{ session.user[0]|upper if session.user else 'U' }}
                                                </div>
                                            {% elif session.service_type == 'komga' %}
                                                <div class="bg-komga text-white w-4 h-4 rounded-full flex items-center justify-center text-[0.5rem] font-bold" style="display: none;">
                                                    {{ session.user[0]|upper if session.user else 'U' }}
                                                </div>
                                            {% elif session.service_type == 'romm' %}
                                                <div class="bg-romm text-white w-4 h-4 rounded-full flex items-center justify-center text-[0.5rem] font-bold" style="display: none;">
                                                    {{ session.user[0]|upper if session.user else 'U' }}
                                                </div>
                                            {% else %}
                                                <div class="bg-primary text-white w-4 h-4 rounded-full flex items-center justify-center text-[0.5rem] font-bold" style="display: none;">
                                                    {{ session.user[0]|upper if session.user else 'U' }}
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                {% else %}
                                    {# Service-aware fallback avatar when no avatar URL #}
                                    <div class="avatar avatar-xs mr-1.5">
                                        <div class="w-4 h-4 rounded-full">
                                            {% if session.service_type == 'jellyfin' %}
                                                <div class="bg-jellyfin text-white w-4 h-4 rounded-full flex items-center justify-center text-[0.5rem] font-bold">
                                                    {{ session.user[0]|upper if session.user else 'U' }}
                                                </div>
                                            {% elif session.service_type == 'plex' %}
                                                <div class="bg-plex text-white w-4 h-4 rounded-full flex items-center justify-center text-[0.5rem] font-bold">
                                                    {{ session.user[0]|upper if session.user else 'U' }}
                                                </div>
                                            {% elif session.service_type == 'emby' %}
                                                <div class="bg-emby text-white w-4 h-4 rounded-full flex items-center justify-center text-[0.5rem] font-bold">
                                                    {{ session.user[0]|upper if session.user else 'U' }}
                                                </div>
                                            {% elif session.service_type == 'kavita' %}
                                                <div class="bg-kavita text-white w-4 h-4 rounded-full flex items-center justify-center text-[0.5rem] font-bold">
                                                    {{ session.user[0]|upper if session.user else 'U' }}
                                                </div>
                                            {% elif session.service_type == 'audiobookshelf' %}
                                                <div class="bg-audiobookshelf text-white w-4 h-4 rounded-full flex items-center justify-center text-[0.5rem] font-bold">
                                                    {{ session.user[0]|upper if session.user else 'U' }}
                                                </div>
                                            {% elif session.service_type == 'komga' %}
                                                <div class="bg-komga text-white w-4 h-4 rounded-full flex items-center justify-center text-[0.5rem] font-bold">
                                                    {{ session.user[0]|upper if session.user else 'U' }}
                                                </div>
                                            {% elif session.service_type == 'romm' %}
                                                <div class="bg-romm text-white w-4 h-4 rounded-full flex items-center justify-center text-[0.5rem] font-bold">
                                                    {{ session.user[0]|upper if session.user else 'U' }}
                                                </div>
                                            {% else %}
                                                <div class="bg-primary text-white w-4 h-4 rounded-full flex items-center justify-center text-[0.5rem] font-bold">
                                                    {{ session.user[0]|upper if session.user else 'U' }}
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                {% endif %}
                                <a href="{{ url_for('user.view_service_account', server_nickname=session.server_name, server_username=session.user) }}" class="link link-hover text-info" title="View user profile">
                                    {{ session.user }}
                                </a>
                            </p>
                            <p class="text-base-content/70 flex items-center" title="{{ session.player_title }} ({{session.player_platform}} via {{session.product}})">
                                <i class="fa-solid fa-play fa-fw mr-1.5 text-info w-4 text-center"></i> 
                                <span class="font-medium mr-1 text-info">Player:</span>
                                {{ session.player_title }} 
                                <span class="text-base-content/50 ml-1">({{session.product if session.product != session.player_title else session.player_platform}})</span>
                            </p>
                             <p class="text-base-content/70 flex items-center">
                                <i class="fa-solid fa-tv fa-fw mr-1.5 text-info w-4 text-center"></i>
                                <span class="font-medium mr-1 text-info">Media/Library:</span>
                                {{ session.media_type }} on {{ session.library_name }}
                            </p>
                            <p class="text-base-content/70 flex items-center" title="Quality: {{ session.quality_detail }}">
                                <i class="fa-solid fa-sliders fa-fw w-4 mr-1.5 text-info text-center"></i>
                                <span class="font-medium mr-1 text-info">Quality:</span>
                                <span>{{ session.quality_detail }}</span>
                            </p>
                            <p class="text-base-content/70 flex items-center" title="Stream: {{ session.stream_detail }}">
                                <i class="fa-solid fa-wifi fa-fw w-4 mr-1.5 text-info text-center"></i>
                                <span class="font-medium mr-1 text-info">Stream:</span>
                                <span class="font-medium {% if session.stream_detail and 'Transcode' in session.stream_detail %}text-orange-400{% else %}text-green-400{% endif %}">
                                    {{ session.stream_detail }}
                                </span>
                                {% if 'Transcode' in session.stream_detail and session.transcode_reason %}
                                    <i class="fa-solid fa-info-circle ml-1 text-orange-400/80" title="Reason: {{ session.transcode_reason }}"></i>
                                {% endif %}
                            </p>
                            <p class="text-base-content/70 flex items-center" title="Container: {{session.container_detail}}">
                                <i class="fa-solid fa-box-archive fa-fw w-4 mr-1.5 text-info text-center"></i>
                                <span class="font-medium mr-1 text-info">Container:</span>
                                <span>{{ session.container_detail }}</span>
                            </p>
                            <p class="text-base-content/70 flex items-center" title="Video: {{session.video_detail}}">
                                <i class="fa-solid fa-film fa-fw w-4 mr-1.5 text-info text-center"></i>
                                <span class="font-medium mr-1 text-info">Video:</span>
                                <span>{{ session.video_detail }}</span>
                            </p>
                            <p class="text-base-content/70 flex items-center" title="Audio: {{session.audio_detail}}">
                                <i class="fa-solid fa-volume-high fa-fw w-4 mr-1.5 text-info text-center"></i>
                                <span class="font-medium mr-1 text-info">Audio:</span>
                                <span>{{ session.audio_detail }}</span>
                            </p>
                            <p class="text-base-content/70 flex items-center" title="Subtitle: {{session.subtitle_detail}}">
                                <i class="fa-solid fa-closed-captioning fa-fw w-4 mr-1.5 text-info text-center"></i>
                                <span class="font-medium mr-1 text-info">Subtitle:</span>
                                <span>{{ session.subtitle_detail }}</span>
                            </p>
                            <p class="text-base-content/70 flex items-center" title="Location: {{session.location_detail}}">
                                <i class="fa-solid fa-location-dot fa-fw w-4 mr-1.5 text-info text-center"></i>
                                <span class="font-medium mr-1 text-info">Location:</span>
                                <span>{{ session.location_detail }}</span>
                                {% if session.is_public_ip %}
                                <button class="btn btn-xs btn-ghost p-1 ml-1"
                                        title="Lookup IP Info"
                                        hx-get="{{ url_for('api.geoip_lookup', ip_address=session.location_ip) }}"
                                        hx-target="#geoip_modal_content_div"
                                        hx-swap="innerHTML"
                                        onclick="geoip_modal.showModal()">
                                    <i class="fa-solid fa-map-location-dot text-accent"></i>
                                </button>
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>

                {# Progress Bar and State (below the flex container) #}
                <!-- DEBUG: Starting progress section for session: {{ session.media_title }} -->
                <div class="mt-2">
                    <div class="flex justify-between items-center mb-0.5">
                        <div class="flex items-center gap-2">
                            <span class="text-xs font-medium uppercase 
                                {% if session.state and session.state.lower() in ['playing', 'listening'] %}text-success
                                {% elif session.state and session.state.lower() == 'paused' %}text-warning
                                {% elif session.state and session.state.lower() == 'buffering' %}text-info
                                {% else %}text-base-content/70{% endif %}">
                                {{ session.state | capitalize if session.state else 'Unknown' }}
                                <!-- DEBUG: state='{{ session.state }}' -->
                            </span>
                            
                            <!-- Server Badge (matching user card style) -->
                            {% if session.service_type == 'plex' %}
                                <span class="inline-flex items-center rounded-md bg-plex-50 dark:bg-plex-400/10 px-2 py-1 text-xs font-medium text-plex-700 dark:text-plex-400 ring-1 ring-inset ring-plex-600/20 dark:ring-plex-500/20 gap-1">
                                    <svg class="w-3 h-3" viewBox="0 0 192 192" xmlns="http://www.w3.org/2000/svg" fill="currentColor" stroke="transparent" stroke-linejoin="round" stroke-width="12"><path d="M22 25.5h48L116 94l-46 68.5H22L68.5 94Zm109.8 56L108 46l14-20.5h48zm-.3 23.5c10.979 17.625 25.52 38.875 38.5 49.5-11.149 13.635-34.323 32.278-62.5-14z"/></svg>
                                    {{ session.server_name }}
                                </span>
                            {% elif session.service_type == 'jellyfin' %}
                                <span class="inline-flex items-center rounded-md bg-jellyfin-50 dark:bg-jellyfin-400/10 px-2 py-1 text-xs font-medium text-jellyfin-700 dark:text-jellyfin-400 ring-1 ring-inset ring-jellyfin-600/20 dark:ring-jellyfin-500/20 gap-1">
                                    <i class="fa-solid fa-cube w-3 h-3"></i>
                                    {{ session.server_name }}
                                </span>
                            {% elif session.service_type == 'emby' %}
                                <span class="inline-flex items-center rounded-md bg-emby-50 dark:bg-emby-400/10 px-2 py-1 text-xs font-medium text-emby-700 dark:text-emby-400 ring-1 ring-inset ring-emby-600/20 dark:ring-emby-500/20 gap-1">
                                    <i class="fa-solid fa-play-circle w-3 h-3"></i>
                                    {{ session.server_name }}
                                </span>
                            {% elif session.service_type == 'kavita' %}
                                <span class="inline-flex items-center rounded-md bg-kavita-50 dark:bg-kavita-400/10 px-2 py-1 text-xs font-medium text-kavita-700 dark:text-kavita-400 ring-1 ring-inset ring-kavita-600/20 dark:ring-kavita-500/20 gap-1">
                                    <i class="fa-solid fa-book w-3 h-3"></i>
                                    {{ session.server_name }}
                                </span>
                            {% elif session.service_type == 'audiobookshelf' %}
                                <span class="inline-flex items-center rounded-md bg-audiobookshelf-50 dark:bg-audiobookshelf-400/10 px-2 py-1 text-xs font-medium text-audiobookshelf-700 dark:text-audiobookshelf-400 ring-1 ring-inset ring-audiobookshelf-600/20 dark:ring-audiobookshelf-500/20 gap-1">
                                    <i class="fa-solid fa-headphones w-3 h-3"></i>
                                    {{ session.server_name }}
                                </span>
                            {% elif session.service_type == 'komga' %}
                                <span class="inline-flex items-center rounded-md bg-komga-50 dark:bg-komga-400/10 px-2 py-1 text-xs font-medium text-komga-700 dark:text-komga-400 ring-1 ring-inset ring-komga-600/20 dark:ring-komga-500/20 gap-1">
                                    <i class="fa-solid fa-book-open w-3 h-3"></i>
                                    {{ session.server_name }}
                                </span>
                            {% elif session.service_type == 'romm' %}
                                <span class="inline-flex items-center rounded-md bg-romm-50 dark:bg-romm-400/10 px-2 py-1 text-xs font-medium text-romm-700 dark:text-romm-400 ring-1 ring-inset ring-romm-600/20 dark:ring-romm-500/20 gap-1">
                                    <i class="fa-solid fa-gamepad w-3 h-3"></i>
                                    {{ session.server_name }}
                                </span>
                            {% else %}
                                <span class="inline-flex items-center rounded-md bg-gray-50 dark:bg-gray-400/10 px-2 py-1 text-xs font-medium text-gray-700 dark:text-gray-400 ring-1 ring-inset ring-gray-600/20 dark:ring-gray-500/20 gap-1">
                                    <i class="fa-solid fa-server w-3 h-3"></i>
                                    {{ session.server_name }}
                                </span>
                            {% endif %}
                        </div>
                        <span class="text-xs text-base-content/70">
                            {% if session.service_type in ['audiobookshelf', 'plex'] and session.current_time and session.duration %}
                                {{ session.current_time }} / {{ session.duration }} ({{ session.progress | round(1) }}%)
                            {% else %}
                                {{ session.progress | round(1) }}%
                            {% endif %}
                            <!-- DEBUG: progress='{{ session.progress }}' -->
                        </span>
                    </div>
                    <progress class="progress progress-xs w-full 
                        {% if session.state and session.state.lower() in ['playing', 'listening'] %}progress-success
                        {% elif session.state and session.state.lower() == 'paused' %}progress-warning 
                        {% elif session.state and session.state.lower() == 'buffering' %}progress-info
                        {% else %}progress-primary{% endif %}" 
                        value="{{ session.progress }}" max="100"></progress>
                    <!-- DEBUG: Media title section for: {{ session.media_title }} -->
                    <h2 class="card-title text-sm font-semibold" title="{{ session.media_title }}">
                        {{ session.media_title or 'Unknown Title' }}
                        {% if session.year %}<span class="text-xs font-normal text-base-content/70">({{ session.year }})</span>{% endif %}
                    </h2>
                    {% if session.media_type == 'Episode' and session.grandparent_title %}
                        <p class="text-xs text-primary" title="{{session.grandparent_title}}{% if session.parent_title %} - {{session.parent_title}}{% endif %}">{{session.grandparent_title}}{% if session.parent_title %} - {{session.parent_title}}{% endif %}</p>
                    {% elif session.media_type == 'Track' and (session.parent_title or session.grandparent_title) %}
                        <p class="text-xs text-primary" title="{{session.grandparent_title}}{% if session.parent_title %} - {{session.parent_title}}{% endif %}">
                            {{session.grandparent_title or ''}}{% if session.grandparent_title and session.parent_title %} - {% endif %}{{session.parent_title or ''}}
                        </p>
                    {% elif session.service_type == 'audiobookshelf' and session.parent_title %}
                        <p class="text-xs text-primary" title="{{session.parent_title}}">
                            <i class="fa-solid fa-user-pen mr-1"></i>{{session.parent_title}}
                        </p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Raw Data Modal -->
        <dialog id="rawDataModal-{{ session.session_key }}" class="modal modal-bottom sm:modal-middle">
            <div class="modal-box max-w-5xl bg-base-100 border border-base-300 shadow-2xl p-0">
                <!-- Header -->
                <div class="flex items-center justify-between p-6 border-b border-base-300">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-secondary/20 flex items-center justify-center">
                            <i class="fa-solid fa-code text-secondary text-lg"></i>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-base-content">Raw Session Data</h3>
                            <p class="text-sm text-base-content/60">Debug information and raw service data</p>
                        </div>
                    </div>
                    <form method="dialog">
                        <button class="btn btn-sm btn-circle btn-ghost hover:bg-base-200">
                            <i class="fa-solid fa-times"></i>
                        </button>
                    </form>
                </div>

                <!-- Content -->
                <div class="p-6">
                    <!-- Session Info Card -->
                    <div class="bg-base-200/50 rounded-lg p-4 mb-6 border border-base-300">
                        <div class="flex items-start gap-3">
                            <div class="w-8 h-8 rounded-full bg-info/20 flex items-center justify-center flex-shrink-0 mt-0.5">
                                <i class="fa-solid fa-play text-info text-sm"></i>
                            </div>
                            <div class="flex-1">
                                <h4 class="font-medium text-base-content mb-1">Session Information</h4>
                                <div class="flex flex-col gap-2 text-sm">
                                    <div><span class="text-base-content/60">User:</span> <span class="font-mono">{{ session.user }}</span></div>
                                    <div><span class="text-base-content/60">Media:</span> <span class="font-mono">{{ session.media_title }}</span></div>
                                    <div><span class="text-base-content/60">Session Key:</span> <span class="font-mono text-xs">{{ session.session_key }}</span></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Raw Data Section -->
                    <div class="space-y-4 mb-6">
                        
                        <div class="bg-base-200/30 rounded-lg border border-base-300/30 hover:border-base-300/60 transition-colors">
                            <div class="flex items-center justify-between p-3 border-b border-base-300/30 bg-base-200/50">
                                <div class="flex items-center gap-2">
                                    <i class="fa-solid fa-code text-secondary text-sm"></i>
                                    <span class="font-medium text-sm">Raw Data Output</span>
                                </div>
                                <div class="text-xs text-base-content/60">
                                    Size: {{ session.raw_data_json|length }} characters
                                </div>
                            </div>
                            <div class="p-4">
                                <div class="bg-base-100 rounded-lg p-4 max-h-96 overflow-auto border border-base-300/30">
                                    <pre class="text-xs whitespace-pre-wrap break-words font-mono text-base-content"><code>{{ session.raw_data_json }}</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex items-center justify-end gap-3 mt-8 pt-6 border-t border-base-300">
                        <button type="button" class="btn btn-ghost" onclick="document.getElementById('rawDataModal-{{ session.session_key }}').close()">
                            Close
                        </button>
                        <button type="button" class="btn btn-secondary gap-2" onclick="copyRawData('rawData-{{ session.session_key }}', this)">
                            <i class="fa-solid fa-copy"></i>
                            Copy to Clipboard
                        </button>
                    </div>
                </div>
                
                <textarea id="rawData-{{ session.session_key }}" class="hidden">{{ session.raw_data_json }}</textarea>
            </div>
        </dialog>
        {% endfor %}
    </div>
{% else %}
    <div class="text-center py-10 bg-base-200 rounded-lg shadow-md">
        <i class="fa-solid fa-video-slash fa-3x text-base-content/30 mb-4"></i>
        <p class="text-xl text-base-content/70">No active streams found.</p>
        <p class="text-sm text-base-content/50 mt-1">If you believe there are active streams, try refreshing manually or wait for the next auto-refresh.</p>
    </div>
{% endif %}

<script>
    function copyRawData(elementId, button) {
        const textToCopy = document.getElementById(elementId).value;
        navigator.clipboard.writeText(textToCopy).then(() => {
            const originalText = button.innerText;
            button.innerText = 'Copied!';
            button.classList.add('btn-success');
            setTimeout(() => {
                button.innerText = originalText;
                button.classList.remove('btn-success');
            }, 2000);
        }).catch(err => {
            console.error('Failed to copy text: ', err);
            const originalText = button.innerText;
            button.innerText = 'Error!';
            button.classList.add('btn-error');
            setTimeout(() => {
                button.innerText = originalText;
                button.classList.remove('btn-error');
            }, 2000);
        });
    }
</script>