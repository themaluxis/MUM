<!-- Clean Header -->
<div class="mb-8">
    <div class="flex items-center gap-3 mb-4">
        <div class="w-10 h-10 rounded-full bg-warning/20 flex items-center justify-center flex-shrink-0">
            <i class="fa-solid fa-cogs text-warning text-lg"></i>
        </div>
        <div>
            <h1 class="text-2xl font-bold text-base-content mb-1">Advanced Settings</h1>
            <p class="text-sm text-base-content/70">Manage advanced configurations and system-level settings</p>
        </div>
    </div>
    
    <!-- Warning Notice -->
    <div class="bg-warning/10 border border-warning/20 rounded-lg p-4">
        <div class="flex items-start gap-3">
            <div class="w-6 h-6 rounded-full bg-warning/20 flex items-center justify-center flex-shrink-0 mt-0.5">
                <i class="fa-solid fa-exclamation-triangle text-warning text-xs"></i>
            </div>
            <div>
                <h4 class="font-medium text-warning mb-1">Caution Required</h4>
                <p class="text-sm text-base-content/80">
                    These settings can significantly impact your application's behavior. Only modify them if you understand the consequences.
                </p>
            </div>
        </div>
    </div>
</div>

<div class="space-y-8">
    <!-- Danger Zone Section -->
    <div class="bg-base-200/30 border border-base-300 rounded-lg p-6">
        <div class="flex items-center gap-3 mb-6">
            <div class="w-8 h-8 rounded-full bg-error/20 flex items-center justify-center flex-shrink-0">
                <i class="fa-solid fa-triangle-exclamation text-error text-sm"></i>
            </div>
            <div>
                <h2 class="text-lg font-semibold text-base-content mb-1">Danger Zone</h2>
                <p class="text-sm text-base-content/70">Irreversible actions that can affect system security and user sessions</p>
            </div>
        </div>
        
        <!-- Secret Key Regeneration -->
        <div class="bg-error/10 border border-error/20 rounded-lg p-4">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
                <div class="flex-1">
                    <div class="flex items-center gap-2 mb-2">
                        <i class="fa-solid fa-key text-error text-sm"></i>
                        <h3 class="font-medium text-base-content">Re-generate Application Secret Key</h3>
                    </div>
                    <p class="text-sm text-base-content/80 mb-2">
                        This will invalidate all current sessions and require all users (including admins) to log in again.
                    </p>
                    <p class="text-xs text-base-content/60">
                        <strong>Use only if:</strong> You suspect the current key is compromised or for security maintenance.
                    </p>
                </div>
                
                <div class="flex flex-col items-end gap-2">
                    <button class="btn btn-error btn-sm"
                            hx-post="{{ url_for('settings.regenerate_secret_key') }}"
                            hx-confirm="⚠️ DANGER: This will log out ALL users immediately!\n\nAre you absolutely sure you want to re-generate the SECRET_KEY?\n\nThis action cannot be undone."
                            hx-target="#secret_key_status_message"
                            hx-swap="innerHTML"
                            hx-indicator="this">
                        <span class="htmx-indicator loading loading-spinner loading-xs mr-2"></span>
                        <i class="fa-solid fa-key mr-2"></i>
                        Re-generate Key
                    </button>
                    <div id="secret_key_status_message" class="text-xs"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Database Settings Section -->
    <div class="bg-base-200/30 border border-base-300 rounded-lg p-6">
        <div class="flex items-center gap-3 mb-6">
            <div class="w-8 h-8 rounded-full bg-info/20 flex items-center justify-center flex-shrink-0">
                <i class="fa-solid fa-database text-info text-sm"></i>
            </div>
            <div>
                <h2 class="text-lg font-semibold text-base-content mb-1">Database Settings</h2>
                <p class="text-sm text-base-content/70">Current configuration values stored in the database</p>
            </div>
        </div>
        
        {% if all_db_settings %}
        <!-- Settings Count Badge -->
        <div class="flex items-center gap-2 mb-4">
            <span class="inline-flex items-center rounded-md bg-blue-50 dark:bg-blue-400/10 px-2 py-1 text-xs font-medium text-blue-700 dark:text-blue-400 ring-1 ring-inset ring-blue-600/20 dark:ring-blue-500/20">
                {{ all_db_settings|length }} settings configured
            </span>
        </div>
        
        <!-- Settings Table -->
        <div class="bg-base-100 border border-base-300 rounded-lg shadow-sm overflow-hidden">
            <div class="overflow-x-auto">
                <table class="table w-full">
                    <thead class="bg-base-200/50">
                        <tr class="border-b border-base-300">
                            <th class="font-medium text-sm text-base-content/80 p-4">Setting Key</th>
                            <th class="font-medium text-sm text-base-content/80 p-4">Name</th>
                            <th class="font-medium text-sm text-base-content/80 p-4">Type</th>
                            <th class="font-medium text-sm text-base-content/80 p-4">Value</th>
                            <th class="font-medium text-sm text-base-content/80 p-4 hidden md:table-cell">Description</th>
                            <th class="font-medium text-sm text-base-content/80 p-4 hidden lg:table-cell">Updated</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for setting in all_db_settings %}
                        <tr class="border-b border-base-200/50 hover:bg-base-200/30 transition-colors">
                            <!-- Setting Key -->
                            <td class="p-4">
                                <div class="flex items-center gap-2">
                                    {% if setting.is_public %}
                                        <div class="w-4 h-4 rounded-full bg-green-500/20 flex items-center justify-center">
                                            <i class="fa-solid fa-eye text-green-600 text-xs"></i>
                                        </div>
                                    {% else %}
                                        <div class="w-4 h-4 rounded-full bg-gray-500/20 flex items-center justify-center">
                                            <i class="fa-solid fa-lock text-gray-600 text-xs"></i>
                                        </div>
                                    {% endif %}
                                    <code class="text-sm font-mono text-base-content bg-base-200/50 px-2 py-1 rounded">{{ setting.key }}</code>
                                </div>
                            </td>
                            
                            <!-- Name -->
                            <td class="p-4">
                                <span class="text-sm font-medium text-base-content">
                                    {{ setting.name or 'Unnamed' }}
                                </span>
                            </td>
                            
                            <!-- Type Badge -->
                            <td class="p-4">
                                {% set type_name = setting.value_type.name.lower() %}
                                {% if type_name == 'string' %}
                                    <span class="inline-flex items-center rounded-md bg-blue-50 dark:bg-blue-400/10 px-2 py-1 text-xs font-medium text-blue-700 dark:text-blue-400 ring-1 ring-inset ring-blue-600/20 dark:ring-blue-500/20">
                                        <i class="fa-solid fa-quote-left mr-1"></i>
                                        String
                                    </span>
                                {% elif type_name == 'integer' %}
                                    <span class="inline-flex items-center rounded-md bg-green-50 dark:bg-green-400/10 px-2 py-1 text-xs font-medium text-green-700 dark:text-green-400 ring-1 ring-inset ring-green-600/20 dark:ring-green-500/20">
                                        <i class="fa-solid fa-hashtag mr-1"></i>
                                        Integer
                                    </span>
                                {% elif type_name == 'boolean' %}
                                    <span class="inline-flex items-center rounded-md bg-purple-50 dark:bg-purple-400/10 px-2 py-1 text-xs font-medium text-purple-700 dark:text-purple-400 ring-1 ring-inset ring-purple-600/20 dark:ring-purple-500/20">
                                        <i class="fa-solid fa-toggle-on mr-1"></i>
                                        Boolean
                                    </span>
                                {% elif type_name == 'json' %}
                                    <span class="inline-flex items-center rounded-md bg-yellow-50 dark:bg-yellow-400/10 px-2 py-1 text-xs font-medium text-yellow-700 dark:text-yellow-400 ring-1 ring-inset ring-yellow-600/20 dark:ring-yellow-500/20">
                                        <i class="fa-solid fa-code mr-1"></i>
                                        JSON
                                    </span>
                                {% elif type_name == 'secret' %}
                                    <span class="inline-flex items-center rounded-md bg-red-50 dark:bg-red-400/10 px-2 py-1 text-xs font-medium text-red-700 dark:text-red-400 ring-1 ring-inset ring-red-600/20 dark:ring-red-500/20">
                                        <i class="fa-solid fa-key mr-1"></i>
                                        Secret
                                    </span>
                                {% else %}
                                    <span class="inline-flex items-center rounded-md bg-gray-50 dark:bg-gray-400/10 px-2 py-1 text-xs font-medium text-gray-700 dark:text-gray-400 ring-1 ring-inset ring-gray-600/20 dark:ring-gray-500/20">
                                        {{ type_name | title }}
                                    </span>
                                {% endif %}
                            </td>
                            
                            <!-- Value -->
                            <td class="p-4 max-w-xs">
                                {% if setting.value_type.name == 'SECRET' %}
                                    <span class="text-sm text-base-content/60 font-mono">••••••••</span>
                                {% elif setting.value_type.name == 'BOOLEAN' %}
                                    {% if setting.get_value() %}
                                        <span class="inline-flex items-center rounded-md bg-green-50 dark:bg-green-400/10 px-2 py-1 text-xs font-medium text-green-700 dark:text-green-400 ring-1 ring-inset ring-green-600/20 dark:ring-green-500/20">
                                            <i class="fa-solid fa-check mr-1"></i>
                                            True
                                        </span>
                                    {% else %}
                                        <span class="inline-flex items-center rounded-md bg-red-50 dark:bg-red-400/10 px-2 py-1 text-xs font-medium text-red-700 dark:text-red-400 ring-1 ring-inset ring-red-600/20 dark:ring-red-500/20">
                                            <i class="fa-solid fa-times mr-1"></i>
                                            False
                                        </span>
                                    {% endif %}
                                {% elif setting.value_type.name == 'JSON' %}
                                    <code class="text-xs font-mono text-base-content/80 bg-base-200/50 px-2 py-1 rounded block truncate" title="{{ setting.value }}">
                                        {{ setting.value | truncate(50) }}
                                    </code>
                                {% elif setting.value %}
                                    <span class="text-sm text-base-content font-mono truncate block" title="{{ setting.value }}">
                                        {{ setting.value | truncate(50) }}
                                    </span>
                                {% else %}
                                    <span class="text-sm text-base-content/50 italic">null</span>
                                {% endif %}
                            </td>
                            
                            <!-- Description -->
                            <td class="p-4 hidden md:table-cell max-w-sm">
                                {% if setting.description %}
                                    <p class="text-sm text-base-content/80 line-clamp-2" title="{{ setting.description }}">
                                        {{ setting.description }}
                                    </p>
                                {% else %}
                                    <span class="text-sm text-base-content/50 italic">No description</span>
                                {% endif %}
                            </td>
                            
                            <!-- Updated -->
                            <td class="p-4 hidden lg:table-cell whitespace-nowrap">
                                {% if setting.updated_at %}
                                    <div class="text-sm text-base-content/80">{{ setting.updated_at | time_ago }}</div>
                                    <div class="text-xs text-base-content/60">{{ setting.updated_at | format_datetime_user(include_time=False) }}</div>
                                {% else %}
                                    <span class="text-sm text-base-content/50">Unknown</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% else %}
        <!-- Empty State -->
        <div class="bg-base-100 border border-base-300 rounded-lg p-12 text-center">
            <div class="w-16 h-16 rounded-full bg-base-200/50 flex items-center justify-center mx-auto mb-4">
                <i class="fa-solid fa-database text-base-content/30 text-2xl"></i>
            </div>
            <h3 class="text-lg font-medium text-base-content mb-2">No Database Settings Found</h3>
            <p class="text-sm text-base-content/60">
                No configuration settings are currently stored in the database, or an error occurred while loading them.
            </p>
        </div>
        {% endif %}
    </div>
    
    <!-- System Information Section -->
    <div class="bg-base-200/30 border border-base-300 rounded-lg p-6">
        <div class="flex items-center gap-3 mb-6">
            <div class="w-8 h-8 rounded-full bg-secondary/20 flex items-center justify-center flex-shrink-0">
                <i class="fa-solid fa-info-circle text-secondary text-sm"></i>
            </div>
            <div>
                <h2 class="text-lg font-semibold text-base-content mb-1">System Information</h2>
                <p class="text-sm text-base-content/70">Application and environment details</p>
            </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <!-- Application Version -->
            <div class="bg-base-100 border border-base-300/50 rounded-lg p-4">
                <div class="flex items-center gap-2 mb-2">
                    <i class="fa-solid fa-tag text-primary text-sm"></i>
                    <h3 class="font-medium text-base-content">Application</h3>
                </div>
                <p class="text-sm text-base-content/80">Media User Manager</p>
                <p class="text-xs text-base-content/60 font-mono">Version: Latest</p>
            </div>
            
            <!-- Environment -->
            <div class="bg-base-100 border border-base-300/50 rounded-lg p-4">
                <div class="flex items-center gap-2 mb-2">
                    <i class="fa-solid fa-server text-info text-sm"></i>
                    <h3 class="font-medium text-base-content">Environment</h3>
                </div>
                <p class="text-sm text-base-content/80">{{ config.get('ENV', 'Unknown') | title }}</p>
                <p class="text-xs text-base-content/60">Flask {{ config.get('FLASK_VERSION', 'Unknown') }}</p>
            </div>
            
            <!-- Debug Mode -->
            <div class="bg-base-100 border border-base-300/50 rounded-lg p-4">
                <div class="flex items-center gap-2 mb-2">
                    <i class="fa-solid fa-bug text-warning text-sm"></i>
                    <h3 class="font-medium text-base-content">Debug Mode</h3>
                </div>
                {% if config.get('DEBUG') %}
                    <span class="inline-flex items-center rounded-md bg-yellow-50 dark:bg-yellow-400/10 px-2 py-1 text-xs font-medium text-yellow-700 dark:text-yellow-400 ring-1 ring-inset ring-yellow-600/20 dark:ring-yellow-500/20">
                        <i class="fa-solid fa-exclamation-triangle mr-1"></i>
                        Enabled
                    </span>
                {% else %}
                    <span class="inline-flex items-center rounded-md bg-green-50 dark:bg-green-400/10 px-2 py-1 text-xs font-medium text-green-700 dark:text-green-400 ring-1 ring-inset ring-green-600/20 dark:ring-green-500/20">
                        <i class="fa-solid fa-check mr-1"></i>
                        Disabled
                    </span>
                {% endif %}
            </div>
        </div>
    </div>
</div>