<!-- File: app/templates/settings/_general_settings.html -->
{# File: app/templates/settings/partials/general.html #}
{# Expects 'form' of type GeneralSettingsForm #}

<!-- Clean Header -->
<div class="mb-8">
    <h1 class="text-2xl font-bold text-base-content mb-2">General Settings</h1>
    <p class="text-base-content/70 text-sm">Configure your application's core settings and behavior.</p>
</div>

<form method="POST" action="{{ url_for('settings.general') }}">
    {{ form.hidden_tag() }}
    
    <div class="space-y-6">
        
        <!-- Application Identity Section -->
        <div class="bg-base-200/30 border border-base-300 rounded-lg p-6">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0">
                    <i class="fa-solid fa-id-card text-primary text-lg"></i>
                </div>
                <div>
                    <h2 class="text-xl font-semibold text-base-content mb-1">Application Identity</h2>
                    <p class="text-sm text-base-content/70">Configure how your application appears to users</p>
                </div>
            </div>
            
            <div class="space-y-4">
                <!-- App Name -->
                <div class="form-control">
                    <label class="label">
                        <span class="label-text font-medium text-sm">{{ form.app_name.label.text }}</span>
                    </label>
                    {{ form.app_name(class="input input-bordered w-full h-11 bg-base-100 border-base-300 focus:border-primary focus:bg-base-100 " + ("input-error" if form.app_name.errors else "")) }}
                    {% if form.app_name.errors %}
                        <label class="label">
                            <span class="label-text-alt text-error">{{ form.app_name.errors[0] }}</span>
                        </label>
                    {% else %}
                        <label class="label">
                            <span class="label-text-alt text-xs text-base-content/60">The public name for this application.</span>
                        </label>
                    {% endif %}
                </div>

                <!-- App Base URL -->
                <div class="form-control">
                    <label class="label">
                        <span class="label-text font-medium text-sm">{{ form.app_base_url.label.text }}</span>
                    </label>
                    {{ form.app_base_url(class="input input-bordered w-full h-11 bg-base-100 border-base-300 focus:border-primary focus:bg-base-100 " + ("input-error" if form.app_base_url.errors else "")) }}
                    {% if form.app_base_url.errors %}
                        <label class="label">
                            <span class="label-text-alt text-error">{{ form.app_base_url.errors[0] }}</span>
                        </label>
                    {% else %}
                        <label class="label">
                            <span class="label-text-alt text-xs text-base-content/60">{{ form.app_base_url.description }}</span>
                        </label>
                    {% endif %}
                </div>

                <!-- App Local URL -->
                <div class="form-control">
                    <label class="label">
                        <span class="label-text font-medium text-sm">{{ form.app_local_url.label.text }}</span>
                    </label>
                    {{ form.app_local_url(class="input input-bordered w-full h-11 bg-base-100 border-base-300 focus:border-primary focus:bg-base-100 " + ("input-error" if form.app_local_url.errors else "")) }}
                    {% if form.app_local_url.errors %}
                        <label class="label">
                            <span class="label-text-alt text-error">{{ form.app_local_url.errors[0] }}</span>
                        </label>
                    {% else %}
                        <label class="label">
                            <span class="label-text-alt text-xs text-base-content/60">{{ form.app_local_url.description }}</span>
                        </label>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Performance & Monitoring Section -->
        <div class="bg-base-200/30 border border-base-300 rounded-lg p-6">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 rounded-full bg-success/20 flex items-center justify-center flex-shrink-0">
                    <i class="fa-solid fa-gauge-high text-success text-lg"></i>
                </div>
                <div>
                    <h2 class="text-xl font-semibold text-base-content mb-1">Performance & Monitoring</h2>
                    <p class="text-sm text-base-content/70">Configure real-time monitoring and performance settings</p>
                </div>
            </div>
            
            <div class="space-y-6">
                <!-- Stream Badge Toggle -->
                <div class="space-y-3">
                    <div class="form-control">
                        <label class="label cursor-pointer justify-start">
                            {{ form.enable_navbar_stream_badge(class="toggle toggle-primary mr-3", id="enable_navbar_stream_badge") }}
                            <span class="label-text font-medium">{{ form.enable_navbar_stream_badge.label.text }}</span>
                        </label>
                        <label class="label">
                            <span class="label-text-alt text-xs text-base-content/60">{{ form.enable_navbar_stream_badge.description }}</span>
                        </label>
                    </div>
                    
                    <!-- Warning Card -->
                    <div class="bg-warning/10 border border-warning/20 rounded-lg p-4">
                        <div class="flex items-start gap-3">
                            <div class="w-6 h-6 rounded-full bg-warning/20 flex items-center justify-center flex-shrink-0 mt-0.5">
                                <i class="fa-solid fa-triangle-exclamation text-warning text-xs"></i>
                            </div>
                            <div>
                                <h4 class="font-medium text-warning mb-1">Performance Warning</h4>
                                <p class="text-sm text-base-content/80">
                                    Enabling this feature checks for streams every 5 seconds, which may cause rate limiting from your media servers and increased load on the MUM server. Only enable if you need real-time stream count updates.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Session Monitoring Interval -->
                <div class="form-control">
                    <label class="label">
                        <span class="label-text font-medium text-sm">{{ form.session_monitoring_interval.label.text }}</span>
                    </label>
                    {{ form.session_monitoring_interval(class="input input-bordered w-full h-11 bg-base-100 border-base-300 focus:border-primary focus:bg-base-100 " + ("input-error" if form.session_monitoring_interval.errors else ""), id="session_monitoring_interval") }}
                    {% if form.session_monitoring_interval.errors %}
                        <label class="label">
                            <span class="label-text-alt text-error">{{ form.session_monitoring_interval.errors[0] }}</span>
                        </label>
                    {% else %}
                        <label class="label">
                            <span class="label-text-alt text-xs text-base-content/60" id="interval-description">{{ form.session_monitoring_interval.description }}</span>
                        </label>
                    {% endif %}
                </div>

                <!-- API Timeout -->
                <div class="space-y-3">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium text-sm">{{ form.api_timeout_seconds.label.text }}</span>
                        </label>
                        {{ form.api_timeout_seconds(class="input input-bordered w-full h-11 bg-base-100 border-base-300 focus:border-primary focus:bg-base-100 " + ("input-error" if form.api_timeout_seconds.errors else "")) }}
                        {% if form.api_timeout_seconds.errors %}
                            <label class="label">
                                <span class="label-text-alt text-error">{{ form.api_timeout_seconds.errors[0] }}</span>
                            </label>
                        {% else %}
                            <label class="label">
                                <span class="label-text-alt text-xs text-base-content/60">{{ form.api_timeout_seconds.description }}</span>
                            </label>
                        {% endif %}
                    </div>
                    
                    <!-- Info Card -->
                    <div class="bg-info/10 border border-info/20 rounded-lg p-4">
                        <div class="flex items-start gap-3">
                            <div class="w-6 h-6 rounded-full bg-info/20 flex items-center justify-center flex-shrink-0 mt-0.5">
                                <i class="fa-solid fa-lightbulb text-info text-xs"></i>
                            </div>
                            <div>
                                <h4 class="font-medium text-info mb-1">Tip</h4>
                                <p class="text-sm text-base-content/80">
                                    Lower timeout values (1-3 seconds) make the app more responsive when servers are offline, but may cause issues with slow networks. Higher values (5-10 seconds) are more reliable but slower when servers are down.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Management Section -->
        <div class="bg-base-200/30 border border-base-300 rounded-lg p-6">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0">
                    <i class="fa-solid fa-users text-primary text-lg"></i>
                </div>
                <div>
                    <h2 class="text-xl font-semibold text-base-content mb-1">User Management</h2>
                    <p class="text-sm text-base-content/70">Configure user account and authentication settings</p>
                </div>
            </div>
            
            <div class="form-control">
                <label class="label cursor-pointer justify-start">
                    {{ form.allow_user_accounts(class="toggle toggle-primary mr-3", id="allow_user_accounts") }}
                    <span class="label-text font-medium">{{ form.allow_user_accounts.label.text }}</span>
                </label>
                <label class="label">
                    <span class="label-text-alt text-xs text-base-content/60">{{ form.allow_user_accounts.description }}</span>
                </label>
            </div>
        </div>

        <!-- Save Button -->
        <div class="flex justify-end pt-6">
            {{ form.submit(class="btn btn-primary") }}
        </div>
    </div>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const navbarToggle = document.getElementById('enable_navbar_stream_badge');
    const intervalInput = document.getElementById('session_monitoring_interval');
    const intervalDescription = document.getElementById('interval-description');
    
    function updateIntervalField() {
        if (navbarToggle.checked) {
            intervalInput.disabled = true;
            intervalInput.classList.add('input-disabled');
            intervalDescription.textContent = 'Disabled when Nav Bar Stream Badge is enabled. Badge updates every 5 seconds.';
        } else {
            intervalInput.disabled = false;
            intervalInput.classList.remove('input-disabled');
            intervalDescription.textContent = 'How often to check for new media sessions (in seconds). Disabled when Nav Bar Stream Badge is enabled.';
        }
    }
    
    // Initial state
    updateIntervalField();
    
    // Listen for navbar toggle changes
    navbarToggle.addEventListener('change', updateIntervalField);
});
</script>
