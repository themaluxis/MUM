<!-- File: app/templates/settings/_general_settings.html -->
{# File: app/templates/settings/partials/general.html #}
{# Expects 'form' of type GeneralSettingsForm #}
<form method="POST" action="{{ url_for('settings.general') }}">
    {{ form.hidden_tag() }}
    <h2 class="text-xl font-semibold mb-6">General Application Settings</h2>

    <div class="space-y-6">
        
        <div class="form-control">
            {{ form.app_name.label(class="label") }}
            {{ form.app_name(class="input input-bordered w-full " + ("input-error" if form.app_name.errors else "")) }}
            {% if form.app_name.errors %}<span class="label-text-alt text-error mt-1">{{ form.app_name.errors[0] }}</span>{% endif %}
            <label class="label"><span class="label-text-alt whitespace-normal">The public name for this application.</span></label>
        </div>

        <div class="form-control">
            {{ form.app_base_url.label(class="label") }}
            {{ form.app_base_url(class="input input-bordered w-full " + ("input-error" if form.app_base_url.errors else "")) }}
            {% if form.app_base_url.errors %}
                <span class="label-text-alt text-error mt-1">{{ form.app_base_url.errors[0] }}</span>
            {% else %}
                <span class="label-text-alt">{{ form.app_base_url.description }}</span>
            {% endif %}
        </div>

        <div class="form-control">
            {{ form.app_local_url.label(class="label") }}
            {{ form.app_local_url(class="input input-bordered w-full " + ("input-error" if form.app_local_url.errors else "")) }}
            {% if form.app_local_url.errors %}
                <span class="label-text-alt text-error mt-1">{{ form.app_local_url.errors[0] }}</span>
            {% else %}
                <span class="label-text-alt">{{ form.app_local_url.description }}</span>
            {% endif %}
        </div>

        <div class="form-control">
            <label class="label cursor-pointer justify-start">
                {{ form.enable_navbar_stream_badge(class="toggle toggle-primary mr-3", id="enable_navbar_stream_badge") }}
                <span class="label-text font-medium">{{ form.enable_navbar_stream_badge.label.text }}</span>
            </label>
            <label class="label block">
                <span class="label-text-alt whitespace-normal">{{ form.enable_navbar_stream_badge.description }}</span>
            </label>
            <div class="alert alert-warning mt-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.464 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z" /></svg>
                <span class="text-sm">
                    <strong>Performance Warning:</strong> Enabling this feature checks for streams every 5 seconds, which may cause rate limiting from your media servers and increased load on the MUM server. Only enable if you need real-time stream count updates.
                </span>
            </div>
        </div>

        <div class="form-control">
            {{ form.session_monitoring_interval.label(class="label whitespace-normal") }}
            {{ form.session_monitoring_interval(class="input input-bordered w-full " + ("input-error" if form.session_monitoring_interval.errors else ""), id="session_monitoring_interval") }}
            {% if form.session_monitoring_interval.errors %}
                <span class="label-text-alt text-error mt-1">{{ form.session_monitoring_interval.errors[0] }}</span>
            {% else %}
                <span class="label-text-alt">{{ form.session_monitoring_interval.description }}</span>
            {% endif %}
        </div>

        <div class="form-control">
            {{ form.api_timeout_seconds.label(class="label whitespace-normal") }}
            {{ form.api_timeout_seconds(class="input input-bordered w-full " + ("input-error" if form.api_timeout_seconds.errors else "")) }}
            {% if form.api_timeout_seconds.errors %}
                <span class="label-text-alt text-error mt-1">{{ form.api_timeout_seconds.errors[0] }}</span>
            {% else %}
                <span class="label-text-alt">{{ form.api_timeout_seconds.description }}</span>
            {% endif %}
            <div class="alert alert-info mt-2">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                <span class="text-sm">
                    <strong>Tip:</strong> Lower timeout values (1-3 seconds) make the app more responsive when servers are offline, but may cause issues with slow networks. Higher values (5-10 seconds) are more reliable but slower when servers are down.
                </span>
            </div>
        </div>

        <div class="form-control">
            <label class="label cursor-pointer justify-start">
                {{ form.allow_user_accounts(class="toggle toggle-primary mr-3") }}
                <span class="label-text font-medium">{{ form.allow_user_accounts.label.text }}</span>
            </label>
            <label class="label">
                <span class="label-text-alt whitespace-normal">{{ form.allow_user_accounts.description }}</span>
            </label>
        </div>

        <div class="flex justify-end pt-4">
            {{ form.submit(class="btn btn-primary") }}
        </div>
    </div>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const navbarToggle = document.getElementById('enable_navbar_stream_badge');
    const intervalInput = document.getElementById('session_monitoring_interval');
    
    function updateIntervalField() {
        if (navbarToggle.checked) {
            intervalInput.disabled = true;
            intervalInput.classList.add('input-disabled');
            intervalInput.parentElement.querySelector('.label-text-alt').textContent = 
                'Disabled when Nav Bar Stream Badge is enabled. Badge updates every 5 seconds.';
        } else {
            intervalInput.disabled = false;
            intervalInput.classList.remove('input-disabled');
            intervalInput.parentElement.querySelector('.label-text-alt').textContent = 
                'How often to check for new media sessions (in seconds). Disabled when Nav Bar Stream Badge is enabled.';
        }
    }
    
    // Initial state
    updateIntervalField();
    
    // Listen for toggle changes
    navbarToggle.addEventListener('change', updateIntervalField);
});
</script>
