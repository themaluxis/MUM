<!-- File: app/templates/roles/partials/add_member_modal.html -->

<form method="POST"
      id="addMemberForm"
      hx-post="{{ url_for('role_management.edit', role_id=role.id, tab='members') }}"
      hx-target="#add_member_modal_content"
      hx-swap="innerHTML"
      hx-on::after-request="if(event.detail.successful) { add_member_modal.close(); }">
    {{ member_form.hidden_tag() }}

    {% if member_form.admins_to_add.choices %}
        <!-- Modal Header -->
        <div class="mb-6">
            <p class="text-base-content/70 text-sm">Select administrators to add to the <strong>{{ role.name }}</strong> role. They will inherit all permissions assigned to this role.</p>
        </div>

        <!-- Available Admins Section -->
        <div class="bg-base-200/30 border border-base-300 rounded-lg p-4 mb-6">
            <div class="flex items-center gap-3 mb-4">
                <div class="w-8 h-8 rounded-full bg-primary/20 flex items-center justify-center">
                    <i class="fa-solid fa-user-plus text-primary text-sm"></i>
                </div>
                <div>
                    <h4 class="font-semibold text-base-content">Available Administrators</h4>
                    <p class="text-xs text-base-content/60">{{ member_form.admins_to_add.choices|length }} admin{{ 's' if member_form.admins_to_add.choices|length != 1 else '' }} available to add</p>
                </div>
            </div>
            
            <!-- Admin List -->
            <div class="bg-base-100 border border-base-300 rounded-lg max-h-64 overflow-y-auto">
                <div class="space-y-1 p-2">
                    {% for subfield in member_form.admins_to_add %}
                        <label class="flex items-center gap-3 p-3 rounded-lg hover:bg-base-200/50 cursor-pointer transition-colors">
                            {{ subfield(class="checkbox checkbox-primary") }}
                            <div class="flex items-center gap-3 flex-1">
                                <div class="w-8 h-8 rounded-full bg-primary/20 flex items-center justify-center">
                                    <i class="fa-solid fa-user text-primary text-xs"></i>
                                </div>
                                <div>
                                    <span class="text-sm font-medium text-base-content">{{ subfield.label.text }}</span>
                                </div>
                            </div>
                        </label>
                    {% endfor %}
                </div>
            </div>
            
            <!-- Helper Text -->
            <div class="mt-3 text-xs text-base-content/60">
                <i class="fa-solid fa-info-circle mr-1"></i>
                Selected administrators will be able to perform all actions permitted by this role
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex justify-end gap-3">
            <button type="button" class="btn btn-ghost" onclick="add_member_modal.close()">
                Cancel
            </button>
            {{ member_form.submit_add_members(class="btn btn-primary") }}
        </div>
        
    {% else %}
        <!-- Empty State -->
        <div class="text-center py-8">
            <div class="w-16 h-16 rounded-full bg-base-200 flex items-center justify-center mx-auto mb-4">
                <i class="fa-solid fa-users-check text-base-content/40 text-2xl"></i>
            </div>
            <h4 class="text-lg font-semibold text-base-content mb-2">All Admins Assigned</h4>
            <p class="text-sm text-base-content/70 mb-6">
                All available administrators are already members of the <strong>{{ role.name }}</strong> role.
            </p>
            <button type="button" class="btn btn-primary" onclick="add_member_modal.close()">
                <i class="fa-solid fa-check mr-2"></i>
                Got it
            </button>
        </div>
    {% endif %}
</form>