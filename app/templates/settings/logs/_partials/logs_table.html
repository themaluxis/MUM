<!-- File: app/templates/settings/_logs_list_content.html -->
{# Expects 'logs' (pagination object) and 'current_per_page' in context #}

{% if logs and logs.items %}
    <!-- Logs Results Header -->
    <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-2">
            <h3 class="font-medium text-base-content">Log Entries</h3>
            <span class="inline-flex items-center rounded-md bg-blue-50 dark:bg-blue-400/10 px-2 py-1 text-xs font-medium text-blue-700 dark:text-blue-400 ring-1 ring-inset ring-blue-600/20 dark:ring-blue-500/20">
                {{ logs.total }} total
            </span>
        </div>
        {% if logs.pages > 1 %}
        <span class="text-sm text-base-content/60">
            Page {{ logs.page }} of {{ logs.pages }}
        </span>
        {% endif %}
    </div>

    <!-- Modern Table Container -->
    <div class="bg-base-100 border border-base-300 rounded-lg shadow-sm overflow-hidden">
        <div class="overflow-x-auto">
            <table class="table w-full">
                <thead class="bg-base-200/50">
                    <tr class="border-b border-base-300">
                        <th class="font-medium text-sm text-base-content/80 p-4">Timestamp</th>
                        <th class="font-medium text-sm text-base-content/80 p-4">Event Type</th>
                        <th class="font-medium text-sm text-base-content/80 p-4">Message</th>
                        <th class="font-medium text-sm text-base-content/80 p-4 hidden md:table-cell">Details</th>
                        <th class="font-medium text-sm text-base-content/80 p-4 hidden sm:table-cell">Actor/Subject</th>
                    </tr>
                </thead>
                <tbody>
                    {% for log in logs.items %}
                    <tr class="border-b border-base-200/50 hover:bg-base-200/30 transition-colors">
                        <!-- Timestamp -->
                        <td class="p-4 whitespace-nowrap" title="{{ log.timestamp | format_datetime_user }}">
                            <div class="text-sm font-medium text-base-content">{{ log.timestamp | time_ago }}</div>
                            <div class="text-xs text-base-content/60 lg:hidden">{{ log.timestamp | format_datetime_user(include_time=False) }}</div>
                        </td>
                        
                        <!-- Event Type with Modern Badge -->
                        <td class="p-4">
                            {% set event_name = log.event_type.name | lower %}
                            {% if 'error' in event_name or 'fail' in event_name %}
                                <span class="inline-flex items-center rounded-md bg-red-50 dark:bg-red-400/10 px-2 py-1 text-xs font-medium text-red-700 dark:text-red-400 ring-1 ring-inset ring-red-600/20 dark:ring-red-500/20 whitespace-nowrap">
                                    <i class="fa-solid fa-exclamation-triangle mr-1"></i>
                                    {{ log.event_type.name | title | replace('_', ' ') }}
                                </span>
                            {% elif 'success' in event_name or 'create' in event_name or 'add' in event_name %}
                                <span class="inline-flex items-center rounded-md bg-green-50 dark:bg-green-400/10 px-2 py-1 text-xs font-medium text-green-700 dark:text-green-400 ring-1 ring-inset ring-green-600/20 dark:ring-green-500/20 whitespace-nowrap">
                                    <i class="fa-solid fa-check-circle mr-1"></i>
                                    {{ log.event_type.name | title | replace('_', ' ') }}
                                </span>
                            {% elif 'warning' in event_name or 'warn' in event_name %}
                                <span class="inline-flex items-center rounded-md bg-yellow-50 dark:bg-yellow-400/10 px-2 py-1 text-xs font-medium text-yellow-700 dark:text-yellow-400 ring-1 ring-inset ring-yellow-600/20 dark:ring-yellow-500/20 whitespace-nowrap">
                                    <i class="fa-solid fa-exclamation-circle mr-1"></i>
                                    {{ log.event_type.name | title | replace('_', ' ') }}
                                </span>
                            {% elif 'delete' in event_name or 'remove' in event_name %}
                                <span class="inline-flex items-center rounded-md bg-red-50 dark:bg-red-400/10 px-2 py-1 text-xs font-medium text-red-700 dark:text-red-400 ring-1 ring-inset ring-red-600/20 dark:ring-red-500/20 whitespace-nowrap">
                                    <i class="fa-solid fa-trash mr-1"></i>
                                    {{ log.event_type.name | title | replace('_', ' ') }}
                                </span>
                            {% elif 'login' in event_name or 'auth' in event_name %}
                                <span class="inline-flex items-center rounded-md bg-blue-50 dark:bg-blue-400/10 px-2 py-1 text-xs font-medium text-blue-700 dark:text-blue-400 ring-1 ring-inset ring-blue-600/20 dark:ring-blue-500/20 whitespace-nowrap">
                                    <i class="fa-solid fa-sign-in-alt mr-1"></i>
                                    {{ log.event_type.name | title | replace('_', ' ') }}
                                </span>
                            {% else %}
                                <span class="inline-flex items-center rounded-md bg-gray-50 dark:bg-gray-400/10 px-2 py-1 text-xs font-medium text-gray-700 dark:text-gray-400 ring-1 ring-inset ring-gray-600/20 dark:ring-gray-500/20 whitespace-nowrap">
                                    <i class="fa-solid fa-circle mr-1"></i>
                                    {{ log.event_type.name | title | replace('_', ' ') }}
                                </span>
                            {% endif %}
                        </td>
                        
                        <!-- Message -->
                        <td class="p-4 max-w-xs lg:max-w-md">
                            <p class="text-sm text-base-content line-clamp-2" title="{{ log.message }}">{{ log.message }}</p>
                        </td>
                        
                        <!-- Details -->
                        <td class="p-4 hidden md:table-cell">
                            {% if log.details and log.details|length > 0 %}
                                <div class="dropdown dropdown-hover dropdown-left">
                                    <label tabindex="0" class="btn btn-xs btn-ghost hover:bg-base-200">
                                        <i class="fa-solid fa-circle-info mr-1"></i> View
                                    </label>
                                    <div tabindex="0" class="dropdown-content z-[1] bg-base-100 border border-base-300 rounded-lg shadow-lg w-64 p-3 max-h-48 overflow-y-auto">
                                        <div class="space-y-2">
                                            {% for key, value in log.details.items() %}
                                                <div class="text-xs">
                                                    <span class="font-medium text-base-content">{{ key|replace('_', ' ')|title }}:</span>
                                                    <span class="text-base-content/80">{{ value | string | truncate(50, True) }}</span>
                                                </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            {% else %}
                                <span class="text-xs text-base-content/50">No details</span>
                            {% endif %}
                        </td>
                        
                        <!-- Actor/Subject -->
                        <td class="p-4 hidden sm:table-cell">
                            {% if log.admin %}
                                <div class="flex items-center gap-2" title="Admin: {{ log.admin.username or log.admin.plex_username }}">
                                    <div class="w-5 h-5 rounded-full bg-warning/20 flex items-center justify-center flex-shrink-0">
                                        <i class="fa-solid fa-user-shield text-warning text-xs"></i>
                                    </div>
                                    <span class="text-sm text-base-content truncate">{{ log.admin.username or log.admin.plex_username | truncate(20) }}</span>
                                </div>
                            {% elif log.affected_user %}
                                <div class="flex items-center gap-2" title="User: {{ log.affected_user.get_display_name() }}">
                                    <div class="w-5 h-5 rounded-full bg-info/20 flex items-center justify-center flex-shrink-0">
                                        <i class="fa-solid fa-user text-info text-xs"></i>
                                    </div>
                                    <span class="text-sm text-base-content truncate">{{ log.affected_user.get_display_name() | truncate(20) }}</span>
                                </div>
                            {% elif log.related_invite %}
                                <div class="flex items-center gap-2" title="Invite: {{ log.related_invite.custom_path or log.related_invite.token }}">
                                    <div class="w-5 h-5 rounded-full bg-secondary/20 flex items-center justify-center flex-shrink-0">
                                        <i class="fa-solid fa-ticket text-secondary text-xs"></i>
                                    </div>
                                    <span class="text-sm text-base-content truncate">{{ log.related_invite.custom_path or log.related_invite.token | truncate(15) }}</span>
                                </div>
                            {% else %}
                                <div class="flex items-center gap-2">
                                    <div class="w-5 h-5 rounded-full bg-base-300 flex items-center justify-center flex-shrink-0">
                                        <i class="fa-solid fa-cog text-base-content/60 text-xs"></i>
                                    </div>
                                    <span class="text-sm text-base-content/60">System</span>
                                </div>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modern Pagination -->
    {% if logs.pages > 1 %}
    <div class="flex items-center justify-between mt-6 pt-4 border-t border-base-300">
        <div class="text-sm text-base-content/60">
            Showing {{ ((logs.page - 1) * logs.per_page) + 1 }} to {{ logs.page * logs.per_page if logs.page * logs.per_page < logs.total else logs.total }} of {{ logs.total }} entries
        </div>
        
        <div class="join">
            {# Previous Page Link #}
            {% set prev_link_args = request.args.to_dict() %}{% set _ = prev_link_args.update({'page': logs.prev_num}) %}
            <a {% if logs.has_prev %}
                   hx-get="{{ url_for('settings.logs_partial', **prev_link_args) }}" 
                   hx-target="#logs_table_container" 
                   hx-swap="innerHTML" 
                   hx-push-url="true" 
               {% else %}
                   href="#" disabled
               {% endif %}
               class="join-item btn btn-sm {{ 'btn-disabled' if not logs.has_prev else '' }}">
                <i class="fa-solid fa-chevron-left"></i>
                Previous
            </a>

            {# Page Number Links #}
            {% for page_num in logs.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=3) %}
                {% if page_num %}
                    {% set page_link_args = request.args.to_dict() %}{% set _ = page_link_args.update({'page': page_num}) %}
                    {% if logs.page == page_num %}
                        <button class="join-item btn btn-sm btn-primary">{{ page_num }}</button>
                    {% else %}
                        <a hx-get="{{ url_for('settings.logs_partial', **page_link_args) }}"
                           hx-target="#logs_table_container"
                           hx-swap="innerHTML"
                           hx-push-url="true"
                           class="join-item btn btn-sm">{{ page_num }}</a>
                    {% endif %}
                {% else %}
                    <button class="join-item btn btn-sm btn-disabled">...</button>
                {% endif %}
            {% endfor %}

            {# Next Page Link #}
            {% set next_link_args = request.args.to_dict() %}{% set _ = next_link_args.update({'page': logs.next_num}) %}
            <a {% if logs.has_next %}
                   hx-get="{{ url_for('settings.logs_partial', **next_link_args) }}"
                   hx-target="#logs_table_container"
                   hx-swap="innerHTML"
                   hx-push-url="true"
               {% else %}
                   href="#" disabled
               {% endif %}
               class="join-item btn btn-sm {{ 'btn-disabled' if not logs.has_next else '' }}">
                Next
                <i class="fa-solid fa-chevron-right"></i>
            </a>
        </div>
    </div>
    {% endif %}
{% else %}
    <!-- Modern Empty State -->
    <div class="bg-base-100 border border-base-300 rounded-lg p-12 text-center">
        <div class="w-16 h-16 rounded-full bg-base-200/50 flex items-center justify-center mx-auto mb-4">
            <i class="fa-solid fa-file-lines text-base-content/30 text-2xl"></i>
        </div>
        <h3 class="text-lg font-medium text-base-content mb-2">No logs found</h3>
        <p class="text-sm text-base-content/60 mb-6">
            {% if request.args %}
                No log entries match your current filter criteria.
            {% else %}
                There are no log entries to display at this time.
            {% endif %}
        </p>
        {% if request.args %}
        <a href="{{ url_for('settings.logs') }}" class="btn btn-primary btn-sm">
            <i class="fa-solid fa-times mr-2"></i>
            Clear All Filters
        </a>
        {% endif %}
    </div>
{% endif %}